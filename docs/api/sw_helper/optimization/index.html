<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.6">
<title>sw_helper.optimization API documentation</title>
<meta name="description" content="å‚æ•°ä¼˜åŒ–æ¨¡å—">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>sw_helper.optimization</code></h1>
</header>
<section id="section-intro">
<p>å‚æ•°ä¼˜åŒ–æ¨¡å—</p>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="sw_helper.optimization.optimizer" href="optimizer.html">sw_helper.optimization.optimizer</a></code></dt>
<dd>
<div class="desc"><p>å‚æ•°ä¼˜åŒ–å¼•æ“ - ä½¿ç”¨FreeCADå®ç°å‚æ•°ä¼˜åŒ–é—­ç¯</p></div>
</dd>
<dt><code class="name"><a title="sw_helper.optimization.parametric" href="parametric.html">sw_helper.optimization.parametric</a></code></dt>
<dd>
<div class="desc"><p>å‚æ•°åŒ–ä¼˜åŒ–æ¨¡å— - å®ç°è®¾è®¡å‚æ•°ä¼˜åŒ–å¾ªç¯</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="sw_helper.optimization.AIAssistedOptimizer"><code class="flex name class">
<span>class <span class="ident">AIAssistedOptimizer</span></span>
<span>(</span><span>cad_connector=None)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class AIAssistedOptimizer(ParametricOptimizer):
    &#34;&#34;&#34;AIè¾…åŠ©ä¼˜åŒ–å™¨&#34;&#34;&#34;

    def __init__(self, cad_connector=None):
        super().__init__(cad_connector)
        from sw_helper.ai.generator import AIGenerator

        self.ai = AIGenerator()

    def ai_guided_optimization(
        self, file_path: str, description: str, target: str = &#34;strength&#34;
    ) -&gt; List[OptimizationResult]:
        &#34;&#34;&#34;
        AIå¼•å¯¼çš„ä¼˜åŒ–

        1. AIåˆ†æå½“å‰è®¾è®¡
        2. ç”Ÿæˆä¼˜åŒ–å»ºè®®
        3. æ‰§è¡Œå‚æ•°è°ƒæ•´
        4. éªŒè¯ç»“æœ

        Args:
            file_path: CADæ–‡ä»¶è·¯å¾„
            description: è®¾è®¡æè¿°
            target: ä¼˜åŒ–ç›®æ ‡
        &#34;&#34;&#34;
        print(&#34;=&#34; * 60)
        print(&#34;AIè¾…åŠ©å‚æ•°ä¼˜åŒ–&#34;)
        print(&#34;=&#34; * 60)

        # 1. AIåˆ†æè®¾è®¡
        print(f&#34;\nğŸ¤– AIåˆ†æè®¾è®¡: {description}&#34;)
        design_data = self.ai.parse_geometry_description(description)

        print(&#34;\nè®¾è®¡å‚æ•°:&#34;)
        for param_name, param_info in design_data.get(&#34;parameters&#34;, {}).items():
            print(f&#34;  â€¢ {param_name}: {param_info[&#39;value&#39;]} {param_info[&#39;unit&#39;]}&#34;)

        # 2. è·å–AIä¼˜åŒ–å»ºè®®
        current_params = {
            k: v[&#34;value&#34;] for k, v in design_data.get(&#34;parameters&#34;, {}).items()
        }

        # æ¨¡æ‹Ÿè´¨é‡æŒ‡æ ‡
        mock_metrics = {&#34;max_stress&#34;: 180e6, &#34;safety_factor&#34;: 1.8, &#34;weight&#34;: 2.5}

        suggestions = self.ai.generate_optimization_suggestions(
            current_params, mock_metrics, target
        )

        print(&#34;\nAIä¼˜åŒ–å»ºè®®:&#34;)
        for i, suggestion in enumerate(suggestions, 1):
            print(f&#34;  {i}. {suggestion[&#39;reason&#39;]}&#34;)
            print(
                f&#34;     å»ºè®®: {suggestion[&#39;type&#39;]} = {suggestion.get(&#39;suggested&#39;, &#39;N/A&#39;)}&#34;
            )
            print(f&#34;     é¢„æœŸæ”¹è¿›: {suggestion.get(&#39;expected_improvement&#39;, &#39;N/A&#39;)}&#34;)

        # 3. æ‰§è¡Œç¬¬ä¸€ä¸ªå»ºè®®çš„ä¼˜åŒ–
        if suggestions:
            first_suggestion = suggestions[0]
            param_name = first_suggestion.get(&#34;parameter&#34;)

            if param_name and param_name in current_params:
                current_val = current_params[param_name]
                suggested_val = first_suggestion.get(&#34;suggested&#34;, current_val * 1.2)

                print(f&#34;\nğŸ”„ æ‰§è¡Œä¼˜åŒ–: ä¿®æ”¹ {param_name}&#34;)
                print(f&#34;   å½“å‰å€¼: {current_val}&#34;)
                print(f&#34;   å»ºè®®å€¼: {suggested_val}&#34;)

                # åˆ›å»ºä¼˜åŒ–é…ç½®
                min_val = min(current_val * 0.8, suggested_val * 0.8)
                max_val = max(current_val * 1.2, suggested_val * 1.2)

                config = OptimizationConfig(
                    target_parameter=param_name,
                    parameter_range=(min_val, max_val),
                    step_size=abs(suggested_val - current_val) / 3,
                    iterations=5,
                    target_metric=target,
                    minimize=(target == &#34;weight&#34;),
                )

                # æ‰§è¡Œä¼˜åŒ–
                results = self.optimize_parameter(file_path, config)

                return results

        return []</code></pre>
</details>
<div class="desc"><p>AIè¾…åŠ©ä¼˜åŒ–å™¨</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="sw_helper.optimization.parametric.ParametricOptimizer" href="parametric.html#sw_helper.optimization.parametric.ParametricOptimizer">ParametricOptimizer</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="sw_helper.optimization.AIAssistedOptimizer.ai_guided_optimization"><code class="name flex">
<span>def <span class="ident">ai_guided_optimization</span></span>(<span>self, file_path:Â str, description:Â str, target:Â strÂ =Â 'strength') â€‘>Â List[<a title="sw_helper.optimization.parametric.OptimizationResult" href="parametric.html#sw_helper.optimization.parametric.OptimizationResult">OptimizationResult</a>]</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ai_guided_optimization(
    self, file_path: str, description: str, target: str = &#34;strength&#34;
) -&gt; List[OptimizationResult]:
    &#34;&#34;&#34;
    AIå¼•å¯¼çš„ä¼˜åŒ–

    1. AIåˆ†æå½“å‰è®¾è®¡
    2. ç”Ÿæˆä¼˜åŒ–å»ºè®®
    3. æ‰§è¡Œå‚æ•°è°ƒæ•´
    4. éªŒè¯ç»“æœ

    Args:
        file_path: CADæ–‡ä»¶è·¯å¾„
        description: è®¾è®¡æè¿°
        target: ä¼˜åŒ–ç›®æ ‡
    &#34;&#34;&#34;
    print(&#34;=&#34; * 60)
    print(&#34;AIè¾…åŠ©å‚æ•°ä¼˜åŒ–&#34;)
    print(&#34;=&#34; * 60)

    # 1. AIåˆ†æè®¾è®¡
    print(f&#34;\nğŸ¤– AIåˆ†æè®¾è®¡: {description}&#34;)
    design_data = self.ai.parse_geometry_description(description)

    print(&#34;\nè®¾è®¡å‚æ•°:&#34;)
    for param_name, param_info in design_data.get(&#34;parameters&#34;, {}).items():
        print(f&#34;  â€¢ {param_name}: {param_info[&#39;value&#39;]} {param_info[&#39;unit&#39;]}&#34;)

    # 2. è·å–AIä¼˜åŒ–å»ºè®®
    current_params = {
        k: v[&#34;value&#34;] for k, v in design_data.get(&#34;parameters&#34;, {}).items()
    }

    # æ¨¡æ‹Ÿè´¨é‡æŒ‡æ ‡
    mock_metrics = {&#34;max_stress&#34;: 180e6, &#34;safety_factor&#34;: 1.8, &#34;weight&#34;: 2.5}

    suggestions = self.ai.generate_optimization_suggestions(
        current_params, mock_metrics, target
    )

    print(&#34;\nAIä¼˜åŒ–å»ºè®®:&#34;)
    for i, suggestion in enumerate(suggestions, 1):
        print(f&#34;  {i}. {suggestion[&#39;reason&#39;]}&#34;)
        print(
            f&#34;     å»ºè®®: {suggestion[&#39;type&#39;]} = {suggestion.get(&#39;suggested&#39;, &#39;N/A&#39;)}&#34;
        )
        print(f&#34;     é¢„æœŸæ”¹è¿›: {suggestion.get(&#39;expected_improvement&#39;, &#39;N/A&#39;)}&#34;)

    # 3. æ‰§è¡Œç¬¬ä¸€ä¸ªå»ºè®®çš„ä¼˜åŒ–
    if suggestions:
        first_suggestion = suggestions[0]
        param_name = first_suggestion.get(&#34;parameter&#34;)

        if param_name and param_name in current_params:
            current_val = current_params[param_name]
            suggested_val = first_suggestion.get(&#34;suggested&#34;, current_val * 1.2)

            print(f&#34;\nğŸ”„ æ‰§è¡Œä¼˜åŒ–: ä¿®æ”¹ {param_name}&#34;)
            print(f&#34;   å½“å‰å€¼: {current_val}&#34;)
            print(f&#34;   å»ºè®®å€¼: {suggested_val}&#34;)

            # åˆ›å»ºä¼˜åŒ–é…ç½®
            min_val = min(current_val * 0.8, suggested_val * 0.8)
            max_val = max(current_val * 1.2, suggested_val * 1.2)

            config = OptimizationConfig(
                target_parameter=param_name,
                parameter_range=(min_val, max_val),
                step_size=abs(suggested_val - current_val) / 3,
                iterations=5,
                target_metric=target,
                minimize=(target == &#34;weight&#34;),
            )

            # æ‰§è¡Œä¼˜åŒ–
            results = self.optimize_parameter(file_path, config)

            return results

    return []</code></pre>
</details>
<div class="desc"><p>AIå¼•å¯¼çš„ä¼˜åŒ–</p>
<ol>
<li>AIåˆ†æå½“å‰è®¾è®¡</li>
<li>ç”Ÿæˆä¼˜åŒ–å»ºè®®</li>
<li>æ‰§è¡Œå‚æ•°è°ƒæ•´</li>
<li>éªŒè¯ç»“æœ</li>
</ol>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>file_path</code></strong></dt>
<dd>CADæ–‡ä»¶è·¯å¾„</dd>
<dt><strong><code>description</code></strong></dt>
<dd>è®¾è®¡æè¿°</dd>
<dt><strong><code>target</code></strong></dt>
<dd>ä¼˜åŒ–ç›®æ ‡</dd>
</dl></div>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="sw_helper.optimization.parametric.ParametricOptimizer" href="parametric.html#sw_helper.optimization.parametric.ParametricOptimizer">ParametricOptimizer</a></b></code>:
<ul class="hlist">
<li><code><a title="sw_helper.optimization.parametric.ParametricOptimizer.export_results_json" href="parametric.html#sw_helper.optimization.parametric.ParametricOptimizer.export_results_json">export_results_json</a></code></li>
<li><code><a title="sw_helper.optimization.parametric.ParametricOptimizer.optimize_fillet_radius" href="parametric.html#sw_helper.optimization.parametric.ParametricOptimizer.optimize_fillet_radius">optimize_fillet_radius</a></code></li>
<li><code><a title="sw_helper.optimization.parametric.ParametricOptimizer.optimize_parameter" href="parametric.html#sw_helper.optimization.parametric.ParametricOptimizer.optimize_parameter">optimize_parameter</a></code></li>
<li><code><a title="sw_helper.optimization.parametric.ParametricOptimizer.plot_results" href="parametric.html#sw_helper.optimization.parametric.ParametricOptimizer.plot_results">plot_results</a></code></li>
<li><code><a title="sw_helper.optimization.parametric.ParametricOptimizer.set_callback" href="parametric.html#sw_helper.optimization.parametric.ParametricOptimizer.set_callback">set_callback</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="sw_helper.optimization.FreeCADOptimizer"><code class="flex name class">
<span>class <span class="ident">FreeCADOptimizer</span></span>
<span>(</span><span>use_mock:Â boolÂ =Â False)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class FreeCADOptimizer:
    &#34;&#34;&#34;FreeCADå‚æ•°ä¼˜åŒ–å™¨&#34;&#34;&#34;

    def __init__(self, use_mock: bool = False):
        self.connector = None
        self.use_mock = use_mock
        self.results: List[OptimizationResult] = []
        self.progress_callback: Optional[Callable[[str], None]] = None

    def set_progress_callback(self, callback: Callable[[str], None]):
        &#34;&#34;&#34;è®¾ç½®è¿›åº¦å›è°ƒå‡½æ•°&#34;&#34;&#34;
        self.progress_callback = callback

    def log(self, message: str):
        &#34;&#34;&#34;è¾“å‡ºæ—¥å¿—&#34;&#34;&#34;
        if self.progress_callback:
            self.progress_callback(message)
        else:
            print(message)

    def connect(self) -&gt; bool:
        &#34;&#34;&#34;è¿æ¥åˆ°FreeCAD&#34;&#34;&#34;
        if self.use_mock:
            from sw_helper.integrations.freecad_connector import FreeCADConnectorMock

            self.connector = FreeCADConnectorMock()
            return self.connector.connect()

        try:
            from sw_helper.integrations.freecad_connector import FreeCADConnector

            self.connector = FreeCADConnector()
            return self.connector.connect()
        except Exception as e:
            self.log(f&#34;Failed to connect to FreeCAD: {e}&#34;)
            self.log(&#34;Switching to mock mode...&#34;)
            self.use_mock = True
            return self.connect()

    def optimize_parameter(
        self,
        file_path: str,
        param_name: str,
        param_range: tuple,
        steps: int = 5,
        step_mode: str = &#34;linear&#34;,
        output_dir: str = &#34;./optimization_output&#34;,
        analyze_geometry: bool = True,
    ) -&gt; List[OptimizationResult]:
        &#34;&#34;&#34;
        ä¼˜åŒ–æŒ‡å®šå‚æ•°

        Args:
            file_path: CADæ–‡ä»¶è·¯å¾„(.FCStd)
            param_name: å‚æ•°å(å¦‚&#34;Fillet_Radius&#34;)
            param_range: (æœ€å°å€¼, æœ€å¤§å€¼)
            steps: è¿­ä»£æ­¥æ•°
            step_mode: æ­¥è¿›æ¨¡å¼ (linear/geometric)
            output_dir: è¾“å‡ºç›®å½•
            analyze_geometry: æ˜¯å¦åˆ†æå‡ ä½•è´¨é‡

        Returns:
            ä¼˜åŒ–ç»“æœåˆ—è¡¨
        &#34;&#34;&#34;
        self.results = []

        # è¿æ¥FreeCAD
        self.log(&#34;Connecting to FreeCAD...&#34;)
        if not self.connect():
            raise RuntimeError(&#34;Failed to connect to FreeCAD&#34;)

        # æ‰“å¼€æ–‡ä»¶
        self.log(f&#34;Opening file: {file_path}&#34;)
        if not self.connector.open_document(file_path):
            raise RuntimeError(f&#34;Failed to open file: {file_path}&#34;)

        # æ˜¾ç¤ºå¯ç”¨å‚æ•°
        self.log(&#34;\nAvailable parameters:&#34;)
        params = self.connector.get_parameters()
        for p in params[:5]:  # æ˜¾ç¤ºå‰5ä¸ª
            self.log(f&#34;  - {p.name} = {p.value} {p.unit}&#34;)

        # æ£€æŸ¥ç›®æ ‡å‚æ•°æ˜¯å¦å­˜åœ¨
        target_param = self.connector.find_parameter(param_name)
        if not target_param:
            if params:
                self.log(f&#34;[Warning] Parameter &#39;{param_name}&#39; not found, available parameters:&#34;)
                for p in params[:10]:  # æ˜¾ç¤ºå‰10ä¸ªå‚æ•°
                    self.log(f&#34;  - {p.name} = {p.value} {p.unit}&#34;)
                raise ValueError(
                    f&#34;Parameter &#39;{param_name}&#39; not found. Please select from the available parameters above.&#34;
                )
            else:
                raise ValueError(
                    f&#34;Parameter &#39;{param_name}&#39; not found, and no parameters were found in the model.&#34;
                )

        # åˆ›å»ºè¾“å‡ºç›®å½•
        output_path = Path(output_dir)
        output_path.mkdir(parents=True, exist_ok=True)

        # ç”Ÿæˆå‚æ•°åºåˆ—
        min_val, max_val = param_range
        if steps == 1:
            values = [min_val]
        elif step_mode == &#34;linear&#34;:
            # çº¿æ€§æ­¥è¿›
            step_size = (max_val - min_val) / (steps - 1)
            values = [min_val + i * step_size for i in range(steps)]
        else:  # geometric
            # ç­‰æ¯”æ­¥è¿›
            import math

            ratio = math.exp(math.log(max_val / min_val) / (steps - 1))
            values = [min_val * (ratio ** i) for i in range(steps)]

        self.log(f&#34;\nStarting optimization for parameter: {param_name}&#34;)
        self.log(f&#34;   Range: {min_val} ~ {max_val} mm&#34;)
        self.log(f&#34;   Steps: {steps}&#34;)
        self.log(f&#34;   Step mode: {step_mode}&#34;)
        self.log(f&#34;   Value sequence: {[round(v, 2) for v in values]}&#34;)
        self.log(&#34;-&#34; * 60)

        # ä¼˜åŒ–å¾ªç¯
        for i, value in enumerate(values, 1):
            iteration_start = time.time()

            self.log(f&#34;\n[Iteration {i}/{steps}] {param_name} = {value:.2f} mm&#34;)

            try:
                # 1. è®¾ç½®å‚æ•°
                self.log(&#34;   Modifying parameter...&#34;)
                if not self.connector.set_parameter(param_name, value):
                    self.log(&#34;   Parameter setting failed, skipping&#34;)
                    continue

                # 2. é‡å»ºæ¨¡å‹
                self.log(&#34;   Rebuilding model...&#34;)
                if not self.connector.rebuild():
                    self.log(&#34;   Warning: Rebuild may have issues&#34;)

                # 3. å¯¼å‡ºæ–‡ä»¶
                export_file = (
                    output_path / f&#34;iter_{i:02d}_{param_name}_{value:.1f}.step&#34;
                )
                self.log(f&#34;   Exporting: {export_file.name}&#34;)

                if not self.connector.export_file(str(export_file), &#34;STEP&#34;):
                    self.log(&#34;   Export failed&#34;)
                    continue

                # 4. åˆ†æè´¨é‡ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                quality_score = 50.0  # åŸºç¡€åˆ†
                allowable_stress = 0.0
                safety_factor = 0.0
                notes = &#34;Not analyzed&#34;

                if analyze_geometry and export_file.exists():
                    self.log(&#34;   Analyzing geometry quality...&#34;)
                    try:
                        from sw_helper.geometry.parser import GeometryParser

                        parser = GeometryParser()
                        geo_data = parser.parse(str(export_file))

                        # è®¡ç®—è´¨é‡åˆ†æ•°
                        quality_score = self._calculate_quality_score(geo_data, value)

                        # è®¡ç®—åŠ›å­¦æ€§èƒ½
                        allowable_stress, safety_factor = self._calculate_mechanical_properties(
                            geo_data, value
                        )

                        notes = f&#34;Volume: {geo_data.get(&#39;volume&#39;, 0):.2e} mÂ³&#34;
                    except Exception as e:
                        self.log(f&#34;   Analysis failed: {e}&#34;)
                        notes = f&#34;Analysis failed: {e}&#34;
                else:
                    notes = &#34;Not analyzed&#34;
                    # æ¨¡æ‹Ÿè´¨é‡åˆ†æ•°å’ŒåŠ›å­¦æ€§èƒ½ï¼ˆç”¨äºæµ‹è¯•ï¼‰
                    quality_score = 50 + (value - min_val) / (max_val - min_val) * 40
                    if param_name.lower() in [&#34;fillet&#34;, &#34;radius&#34;, &#34;r&#34;]:
                        # åœ†è§’åŠå¾„åœ¨é€‚ä¸­èŒƒå›´å¾—åˆ†é«˜
                        optimal = (min_val + max_val) / 2
                        quality_score = (
                            100 - abs(value - optimal) / (max_val - min_val) * 50
                        )

                    # æ¨¡æ‹ŸåŠ›å­¦æ€§èƒ½
                    allowable_stress, safety_factor = self._calculate_mechanical_properties(
                        {}, value
                    )

                analysis_time = time.time() - iteration_start

                # è®°å½•ç»“æœ
                result = OptimizationResult(
                    iteration=i,
                    parameter_name=param_name,
                    parameter_value=value,
                    quality_score=quality_score,
                    allowable_stress=allowable_stress,
                    safety_factor=safety_factor,
                    analysis_time=analysis_time,
                    timestamp=datetime.now().isoformat(),
                    notes=notes,
                    export_path=str(export_file),
                )

                self.results.append(result)

                self.log(f&#34;   Quality score: {quality_score:.1f}/100&#34;)
                self.log(f&#34;   Time elapsed: {analysis_time:.2f}s&#34;)

            except Exception as e:
                self.log(f&#34;   âœ— é”™è¯¯: {e}&#34;)
                import traceback

                traceback.print_exc()
                continue

        # å…³é—­æ–‡æ¡£
        self.log(&#34;\nClosing document...&#34;)
        self.connector.close_document(save=False)
        self.connector.disconnect()

        # ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
        if self.results:
            self._generate_summary()

        return self.results

    def _calculate_quality_score(self, geo_data: Dict, param_value: float) -&gt; float:
        &#34;&#34;&#34;è®¡ç®—è´¨é‡åˆ†æ•° - åŒ…å«è®¸ç”¨åº”åŠ›å’Œå®‰å…¨ç³»æ•°åˆ†æï¼ˆæ”¹è¿›ç‰ˆï¼‰&#34;&#34;&#34;
        score = 50.0  # åŸºç¡€åˆ†

        # ä½“ç§¯åˆç†æ€§
        volume = geo_data.get(&#34;volume&#34;, 0)
        if 0.0001 &lt; volume &lt; 0.01:  # åˆç†çš„ä½“ç§¯èŒƒå›´
            score += 15
        elif volume &lt; 0.0001:
            score += 5  # è¿‡å°ä½“ç§¯
        elif volume &lt; 0.1:
            score += 10  # ç¨å¤§ä½“ç§¯
        else:
            score += 5  # è¿‡å¤§ä½“ç§¯

        # å‡ ä½•å¤æ‚åº¦
        vertices = geo_data.get(&#34;vertices&#34;, 0)
        if 100 &lt; vertices &lt; 50000:
            score += 10
        elif vertices &lt; 100:
            score += 5  # è¿‡äºç®€å•
        else:
            score += 7  # è¿‡äºå¤æ‚

        # é¢æ•°åˆç†æ€§
        faces = geo_data.get(&#34;faces&#34;, 0)
        if 100 &lt; faces &lt; 10000:
            score += 10
        elif faces &lt; 100:
            score += 5  # è¿‡äºç®€å•
        else:
            score += 7  # è¿‡äºå¤æ‚

        # å‚æ•°ä¼˜åŒ–åŠ åˆ†ï¼ˆå‡è®¾é€‚ä¸­çš„å‚æ•°å€¼æ›´å¥½ï¼‰
        min_param = 5
        max_param = 15
        if min_param &lt; param_value &lt; max_param:
            score += 20
        elif param_value &lt;= min_param:
            score += 10
        else:
            score += 15

        # åŠ›å­¦æ€§èƒ½åŠ åˆ†
        allowable_stress, safety_factor = self._calculate_mechanical_properties(geo_data, param_value)
        if allowable_stress &gt; 140:
            score += 10
        elif allowable_stress &gt; 120:
            score += 5
        else:
            score += 2

        if safety_factor &gt; 2.0:
            score += 10
        elif safety_factor &gt; 1.5:
            score += 5
        else:
            score += 2

        return min(100, max(0, score))

    def _calculate_mechanical_properties(self, geo_data: Dict, param_value: float) -&gt; tuple:
        &#34;&#34;&#34;è®¡ç®—åŠ›å­¦æ€§èƒ½ - è®¸ç”¨åº”åŠ›å’Œå®‰å…¨ç³»æ•°ï¼ˆæ”¹è¿›ç‰ˆï¼‰&#34;&#34;&#34;
        # å‡è®¾ææ–™ä¸ºQ235é’¢
        yield_strength = 235  # MPa

        # æ ¹æ®å‡ ä½•ä¿¡æ¯è°ƒæ•´è®¡ç®—
        volume = geo_data.get(&#34;volume&#34;, 0)
        vertices = geo_data.get(&#34;vertices&#34;, 0)
        faces = geo_data.get(&#34;faces&#34;, 0)

        # åŸºç¡€å®‰å…¨ç³»æ•°
        base_safety_factor = 1.5

        # æ ¹æ®å‚æ•°å€¼è°ƒæ•´
        if param_value &lt; 5:
            param_factor = 0.8  # è¾ƒå°å‚æ•°å€¼ï¼Œé™ä½è®¸ç”¨åº”åŠ›
            safety_factor = base_safety_factor * 1.2  # å¢åŠ å®‰å…¨ç³»æ•°
        elif param_value &lt; 15:
            param_factor = 1.0  # é€‚ä¸­å‚æ•°å€¼ï¼Œæ­£å¸¸è®¸ç”¨åº”åŠ›
            safety_factor = base_safety_factor
        else:
            param_factor = 0.9  # è¾ƒå¤§å‚æ•°å€¼ï¼Œç•¥ä½è®¸ç”¨åº”åŠ›
            safety_factor = base_safety_factor * 1.1

        # æ ¹æ®ä½“ç§¯è°ƒæ•´
        if volume &lt; 0.0001:
            volume_factor = 0.7  # å°ä½“ç§¯ï¼Œé™ä½è®¸ç”¨åº”åŠ›
        elif volume &lt; 0.01:
            volume_factor = 1.0  # åˆç†ä½“ç§¯èŒƒå›´
        else:
            volume_factor = 0.8  # å¤§ä½“ç§¯ï¼Œé™ä½è®¸ç”¨åº”åŠ›

        # æ ¹æ®å¤æ‚åº¦è°ƒæ•´
        complexity = vertices + faces
        if complexity &lt; 1000:
            complexity_factor = 1.1  # ç®€å•å‡ ä½•ï¼Œæé«˜è®¸ç”¨åº”åŠ›
        elif complexity &lt; 10000:
            complexity_factor = 1.0  # é€‚ä¸­å¤æ‚åº¦
        else:
            complexity_factor = 0.9  # å¤æ‚å‡ ä½•ï¼Œé™ä½è®¸ç”¨åº”åŠ›

        # ç»¼åˆè®¡ç®—è®¸ç”¨åº”åŠ›
        allowable_stress = yield_strength * param_factor * volume_factor * complexity_factor

        # ç¡®ä¿è®¸ç”¨åº”åŠ›åœ¨åˆç†èŒƒå›´å†…
        allowable_stress = max(50, min(allowable_stress, yield_strength * 0.7))

        # ç¡®ä¿å®‰å…¨ç³»æ•°åœ¨åˆç†èŒƒå›´å†…
        safety_factor = max(1.2, min(safety_factor, 3.0))

        return allowable_stress, safety_factor

    def _generate_summary(self):
        &#34;&#34;&#34;ç”Ÿæˆä¼˜åŒ–æ€»ç»“&#34;&#34;&#34;
        if not self.results:
            return

        best = max(self.results, key=lambda x: x.quality_score)

        self.log(&#34;\n&#34; + &#34;=&#34; * 60)
        self.log(&#34;Optimization complete!&#34;)
        self.log(&#34;=&#34; * 60)
        self.log(f&#34;Total iterations: {len(self.results)}&#34;)
        self.log(f&#34;Best iteration: #{best.iteration}&#34;)
        self.log(f&#34;Best parameter: {best.parameter_name} = {best.parameter_value:.2f} mm&#34;)
        self.log(f&#34;Top quality score: {best.quality_score:.1f}/100&#34;)
        self.log(f&#34;Total time: {sum(r.analysis_time for r in self.results):.2f}s&#34;)
        self.log(&#34;=&#34; * 60)

    def export_results(self, output_file: str):
        &#34;&#34;&#34;å¯¼å‡ºç»“æœä¸ºJSON&#34;&#34;&#34;
        if not self.results:
            return

        data = {
            &#34;optimization_type&#34;: &#34;parametric&#34;,
            &#34;timestamp&#34;: datetime.now().isoformat(),
            &#34;total_iterations&#34;: len(self.results),
            &#34;results&#34;: [asdict(r) for r in self.results],
        }

        # æ·»åŠ æœ€ä½³ç»“æœ
        best = max(self.results, key=lambda x: x.quality_score)
        data[&#34;best_result&#34;] = asdict(best)

        with open(output_file, &#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
            json.dump(data, f, indent=2, ensure_ascii=False)

        self.log(f&#34;\nResults saved: {output_file}&#34;)

    def plot_results(self, output_file: str = &#34;optimization_plot.png&#34;):
        &#34;&#34;&#34;ç»˜åˆ¶ä¼˜åŒ–ç»“æœå›¾è¡¨&#34;&#34;&#34;
        try:
            import matplotlib.pyplot as plt
            import matplotlib

            matplotlib.use(&#34;Agg&#34;)  # éäº¤äº’å¼åç«¯

            values = [r.parameter_value for r in self.results]
            scores = [r.quality_score for r in self.results]
            allowable_stresses = [r.allowable_stress for r in self.results]
            safety_factors = [r.safety_factor for r in self.results]

            fig, (ax1, ax2, ax3) = plt.subplots(3, 1, figsize=(10, 12), sharex=True)

            # å›¾1: è´¨é‡åˆ†æ•° vs å‚æ•°å€¼
            ax1.plot(values, scores, &#34;b-o&#34;, linewidth=2, markersize=8)
            ax1.set_xlabel(&#34;Parameter Value (mm)&#34;, fontsize=12)
            ax1.set_ylabel(&#34;Quality Score&#34;, fontsize=12)
            ax1.set_title(&#34;Quality Score vs Parameter Value&#34;, fontsize=14, pad=10)
            ax1.grid(True, alpha=0.3)
            ax1.set_ylim(0, 100)

            # æ ‡è®°æœ€ä½³ç‚¹
            best_idx = scores.index(max(scores))
            ax1.plot(
                values[best_idx],
                scores[best_idx],
                &#34;r*&#34;,
                markersize=20,
                label=&#34;Best&#34;,
            )
            ax1.legend()

            # å›¾2: è®¸ç”¨åº”åŠ› vs å‚æ•°å€¼
            ax2.plot(values, allowable_stresses, &#34;g-s&#34;, linewidth=2, markersize=8)
            ax2.set_xlabel(&#34;Parameter Value (mm)&#34;, fontsize=12)
            ax2.set_ylabel(&#34;Allowable Stress (MPa)&#34;, fontsize=12)
            ax2.set_title(&#34;Allowable Stress vs Parameter Value&#34;, fontsize=14, pad=10)
            ax2.grid(True, alpha=0.3)

            # æ ‡è®°æœ€ä½³ç‚¹
            ax2.plot(
                values[best_idx],
                allowable_stresses[best_idx],
                &#34;r*&#34;,
                markersize=20,
                label=&#34;Best&#34;,
            )
            ax2.legend()

            # å›¾3: å®‰å…¨ç³»æ•° vs å‚æ•°å€¼
            ax3.plot(values, safety_factors, &#34;m-^&#34;, linewidth=2, markersize=8)
            ax3.set_xlabel(&#34;Parameter Value (mm)&#34;, fontsize=12)
            ax3.set_ylabel(&#34;Safety Factor&#34;, fontsize=12)
            ax3.set_title(&#34;Safety Factor vs Parameter Value&#34;, fontsize=14, pad=10)
            ax3.grid(True, alpha=0.3)

            # æ ‡è®°æœ€ä½³ç‚¹
            ax3.plot(
                values[best_idx],
                safety_factors[best_idx],
                &#34;r*&#34;,
                markersize=20,
                label=&#34;Best&#34;,
            )
            ax3.legend()

            plt.tight_layout()
            plt.savefig(output_file, dpi=300, bbox_inches=&#34;tight&#34;)
            plt.close()

            self.log(f&#34;Plot saved: {output_file}&#34;)

        except ImportError:
            self.log(&#34;matplotlib not installed, skipping plot&#34;)
        except Exception as e:
            self.log(f&#34;Plot failed: {e}&#34;)

    def generate_report(self, output_file: str = &#34;optimization_report.md&#34;):
        &#34;&#34;&#34;ç”ŸæˆMarkdownæŠ¥å‘Š&#34;&#34;&#34;
        if not self.results:
            return

        best = max(self.results, key=lambda x: x.quality_score)

        report = f&#34;&#34;&#34;# å‚æ•°ä¼˜åŒ–æŠ¥å‘Š

## ä¼˜åŒ–æ¦‚è§ˆ

- **ä¼˜åŒ–å‚æ•°**: {best.parameter_name}
- **æ€»è¿­ä»£æ¬¡æ•°**: {len(self.results)}
- **ä¼˜åŒ–æ—¶é—´**: {datetime.now().strftime(&#34;%Y-%m-%d %H:%M:%S&#34;)}

## æœ€ä½³ç»“æœ

- **è¿­ä»£ç¼–å·**: {best.iteration}
- **æœ€ä½³å‚æ•°å€¼**: {best.parameter_value:.2f} mm
- **æœ€é«˜è´¨é‡åˆ†**: {best.quality_score:.1f}/100
- **è®¸ç”¨åº”åŠ›**: {best.allowable_stress:.1f} MPa
- **å®‰å…¨ç³»æ•°**: {best.safety_factor:.2f}
- **åˆ†æè€—æ—¶**: {best.analysis_time:.2f}s
- **è¾“å‡ºæ–‡ä»¶**: `{best.export_path}`

## è¯¦ç»†ç»“æœ

| è¿­ä»£ | å‚æ•°å€¼ (mm) | è´¨é‡åˆ†æ•° | è®¸ç”¨åº”åŠ› (MPa) | å®‰å…¨ç³»æ•° | è€—æ—¶ (s) | å¤‡æ³¨ |
|------|-------------|----------|----------------|----------|----------|------|
&#34;&#34;&#34;

        for r in self.results:
            marker = &#34;â­&#34; if r == best else &#34;&#34;
            report += f&#34;| {r.iteration} | {r.parameter_value:.2f} | {r.quality_score:.1f} {marker} | {r.allowable_stress:.1f} | {r.safety_factor:.2f} | {r.analysis_time:.2f} | {r.notes} |\n&#34;

        report += f&#34;&#34;&#34;

## ç»Ÿè®¡ä¿¡æ¯

- **å¹³å‡è´¨é‡åˆ†æ•°**: {sum(r.quality_score for r in self.results) / len(self.results):.1f}
- **è´¨é‡åˆ†æ•°èŒƒå›´**: {min(r.quality_score for r in self.results):.1f} ~ {max(r.quality_score for r in self.results):.1f}
- **å¹³å‡è®¸ç”¨åº”åŠ›**: {sum(r.allowable_stress for r in self.results) / len(self.results):.1f} MPa
- **è®¸ç”¨åº”åŠ›èŒƒå›´**: {min(r.allowable_stress for r in self.results):.1f} ~ {max(r.allowable_stress for r in self.results):.1f} MPa
- **å¹³å‡å®‰å…¨ç³»æ•°**: {sum(r.safety_factor for r in self.results) / len(self.results):.2f}
- **å®‰å…¨ç³»æ•°èŒƒå›´**: {min(r.safety_factor for r in self.results):.2f} ~ {max(r.safety_factor for r in self.results):.2f}
- **æ€»è€—æ—¶**: {sum(r.analysis_time for r in self.results):.2f}s
- **å¹³å‡è¿­ä»£è€—æ—¶**: {sum(r.analysis_time for r in self.results) / len(self.results):.2f}s

## å»ºè®®

åŸºäºä¼˜åŒ–ç»“æœï¼Œå»ºè®®é‡‡ç”¨ä»¥ä¸‹å‚æ•°ï¼š

- **{best.parameter_name}**: {best.parameter_value:.2f} mm
- **é¢„æœŸè´¨é‡åˆ†æ•°**: {best.quality_score:.1f}/100
- **é¢„æœŸè®¸ç”¨åº”åŠ›**: {best.allowable_stress:.1f} MPa
- **é¢„æœŸå®‰å…¨ç³»æ•°**: {best.safety_factor:.2f}

---
*Generated by CAE-CLI Optimize*
&#34;&#34;&#34;

        with open(output_file, &#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
            f.write(report)

        self.log(f&#34;Report generated: {output_file}&#34;)</code></pre>
</details>
<div class="desc"><p>FreeCADå‚æ•°ä¼˜åŒ–å™¨</p></div>
<h3>Methods</h3>
<dl>
<dt id="sw_helper.optimization.FreeCADOptimizer.connect"><code class="name flex">
<span>def <span class="ident">connect</span></span>(<span>self) â€‘>Â bool</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def connect(self) -&gt; bool:
    &#34;&#34;&#34;è¿æ¥åˆ°FreeCAD&#34;&#34;&#34;
    if self.use_mock:
        from sw_helper.integrations.freecad_connector import FreeCADConnectorMock

        self.connector = FreeCADConnectorMock()
        return self.connector.connect()

    try:
        from sw_helper.integrations.freecad_connector import FreeCADConnector

        self.connector = FreeCADConnector()
        return self.connector.connect()
    except Exception as e:
        self.log(f&#34;Failed to connect to FreeCAD: {e}&#34;)
        self.log(&#34;Switching to mock mode...&#34;)
        self.use_mock = True
        return self.connect()</code></pre>
</details>
<div class="desc"><p>è¿æ¥åˆ°FreeCAD</p></div>
</dd>
<dt id="sw_helper.optimization.FreeCADOptimizer.export_results"><code class="name flex">
<span>def <span class="ident">export_results</span></span>(<span>self, output_file:Â str)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def export_results(self, output_file: str):
    &#34;&#34;&#34;å¯¼å‡ºç»“æœä¸ºJSON&#34;&#34;&#34;
    if not self.results:
        return

    data = {
        &#34;optimization_type&#34;: &#34;parametric&#34;,
        &#34;timestamp&#34;: datetime.now().isoformat(),
        &#34;total_iterations&#34;: len(self.results),
        &#34;results&#34;: [asdict(r) for r in self.results],
    }

    # æ·»åŠ æœ€ä½³ç»“æœ
    best = max(self.results, key=lambda x: x.quality_score)
    data[&#34;best_result&#34;] = asdict(best)

    with open(output_file, &#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
        json.dump(data, f, indent=2, ensure_ascii=False)

    self.log(f&#34;\nResults saved: {output_file}&#34;)</code></pre>
</details>
<div class="desc"><p>å¯¼å‡ºç»“æœä¸ºJSON</p></div>
</dd>
<dt id="sw_helper.optimization.FreeCADOptimizer.generate_report"><code class="name flex">
<span>def <span class="ident">generate_report</span></span>(<span>self, output_file:Â strÂ =Â 'optimization_report.md')</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">    def generate_report(self, output_file: str = &#34;optimization_report.md&#34;):
        &#34;&#34;&#34;ç”ŸæˆMarkdownæŠ¥å‘Š&#34;&#34;&#34;
        if not self.results:
            return

        best = max(self.results, key=lambda x: x.quality_score)

        report = f&#34;&#34;&#34;# å‚æ•°ä¼˜åŒ–æŠ¥å‘Š

## ä¼˜åŒ–æ¦‚è§ˆ

- **ä¼˜åŒ–å‚æ•°**: {best.parameter_name}
- **æ€»è¿­ä»£æ¬¡æ•°**: {len(self.results)}
- **ä¼˜åŒ–æ—¶é—´**: {datetime.now().strftime(&#34;%Y-%m-%d %H:%M:%S&#34;)}

## æœ€ä½³ç»“æœ

- **è¿­ä»£ç¼–å·**: {best.iteration}
- **æœ€ä½³å‚æ•°å€¼**: {best.parameter_value:.2f} mm
- **æœ€é«˜è´¨é‡åˆ†**: {best.quality_score:.1f}/100
- **è®¸ç”¨åº”åŠ›**: {best.allowable_stress:.1f} MPa
- **å®‰å…¨ç³»æ•°**: {best.safety_factor:.2f}
- **åˆ†æè€—æ—¶**: {best.analysis_time:.2f}s
- **è¾“å‡ºæ–‡ä»¶**: `{best.export_path}`

## è¯¦ç»†ç»“æœ

| è¿­ä»£ | å‚æ•°å€¼ (mm) | è´¨é‡åˆ†æ•° | è®¸ç”¨åº”åŠ› (MPa) | å®‰å…¨ç³»æ•° | è€—æ—¶ (s) | å¤‡æ³¨ |
|------|-------------|----------|----------------|----------|----------|------|
&#34;&#34;&#34;

        for r in self.results:
            marker = &#34;â­&#34; if r == best else &#34;&#34;
            report += f&#34;| {r.iteration} | {r.parameter_value:.2f} | {r.quality_score:.1f} {marker} | {r.allowable_stress:.1f} | {r.safety_factor:.2f} | {r.analysis_time:.2f} | {r.notes} |\n&#34;

        report += f&#34;&#34;&#34;

## ç»Ÿè®¡ä¿¡æ¯

- **å¹³å‡è´¨é‡åˆ†æ•°**: {sum(r.quality_score for r in self.results) / len(self.results):.1f}
- **è´¨é‡åˆ†æ•°èŒƒå›´**: {min(r.quality_score for r in self.results):.1f} ~ {max(r.quality_score for r in self.results):.1f}
- **å¹³å‡è®¸ç”¨åº”åŠ›**: {sum(r.allowable_stress for r in self.results) / len(self.results):.1f} MPa
- **è®¸ç”¨åº”åŠ›èŒƒå›´**: {min(r.allowable_stress for r in self.results):.1f} ~ {max(r.allowable_stress for r in self.results):.1f} MPa
- **å¹³å‡å®‰å…¨ç³»æ•°**: {sum(r.safety_factor for r in self.results) / len(self.results):.2f}
- **å®‰å…¨ç³»æ•°èŒƒå›´**: {min(r.safety_factor for r in self.results):.2f} ~ {max(r.safety_factor for r in self.results):.2f}
- **æ€»è€—æ—¶**: {sum(r.analysis_time for r in self.results):.2f}s
- **å¹³å‡è¿­ä»£è€—æ—¶**: {sum(r.analysis_time for r in self.results) / len(self.results):.2f}s

## å»ºè®®

åŸºäºä¼˜åŒ–ç»“æœï¼Œå»ºè®®é‡‡ç”¨ä»¥ä¸‹å‚æ•°ï¼š

- **{best.parameter_name}**: {best.parameter_value:.2f} mm
- **é¢„æœŸè´¨é‡åˆ†æ•°**: {best.quality_score:.1f}/100
- **é¢„æœŸè®¸ç”¨åº”åŠ›**: {best.allowable_stress:.1f} MPa
- **é¢„æœŸå®‰å…¨ç³»æ•°**: {best.safety_factor:.2f}

---
*Generated by CAE-CLI Optimize*
&#34;&#34;&#34;

        with open(output_file, &#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
            f.write(report)

        self.log(f&#34;Report generated: {output_file}&#34;)</code></pre>
</details>
<div class="desc"><p>ç”ŸæˆMarkdownæŠ¥å‘Š</p></div>
</dd>
<dt id="sw_helper.optimization.FreeCADOptimizer.log"><code class="name flex">
<span>def <span class="ident">log</span></span>(<span>self, message:Â str)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def log(self, message: str):
    &#34;&#34;&#34;è¾“å‡ºæ—¥å¿—&#34;&#34;&#34;
    if self.progress_callback:
        self.progress_callback(message)
    else:
        print(message)</code></pre>
</details>
<div class="desc"><p>è¾“å‡ºæ—¥å¿—</p></div>
</dd>
<dt id="sw_helper.optimization.FreeCADOptimizer.optimize_parameter"><code class="name flex">
<span>def <span class="ident">optimize_parameter</span></span>(<span>self,<br>file_path:Â str,<br>param_name:Â str,<br>param_range:Â tuple,<br>steps:Â intÂ =Â 5,<br>step_mode:Â strÂ =Â 'linear',<br>output_dir:Â strÂ =Â './optimization_output',<br>analyze_geometry:Â boolÂ =Â True) â€‘>Â List[<a title="sw_helper.optimization.optimizer.OptimizationResult" href="optimizer.html#sw_helper.optimization.optimizer.OptimizationResult">OptimizationResult</a>]</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def optimize_parameter(
    self,
    file_path: str,
    param_name: str,
    param_range: tuple,
    steps: int = 5,
    step_mode: str = &#34;linear&#34;,
    output_dir: str = &#34;./optimization_output&#34;,
    analyze_geometry: bool = True,
) -&gt; List[OptimizationResult]:
    &#34;&#34;&#34;
    ä¼˜åŒ–æŒ‡å®šå‚æ•°

    Args:
        file_path: CADæ–‡ä»¶è·¯å¾„(.FCStd)
        param_name: å‚æ•°å(å¦‚&#34;Fillet_Radius&#34;)
        param_range: (æœ€å°å€¼, æœ€å¤§å€¼)
        steps: è¿­ä»£æ­¥æ•°
        step_mode: æ­¥è¿›æ¨¡å¼ (linear/geometric)
        output_dir: è¾“å‡ºç›®å½•
        analyze_geometry: æ˜¯å¦åˆ†æå‡ ä½•è´¨é‡

    Returns:
        ä¼˜åŒ–ç»“æœåˆ—è¡¨
    &#34;&#34;&#34;
    self.results = []

    # è¿æ¥FreeCAD
    self.log(&#34;Connecting to FreeCAD...&#34;)
    if not self.connect():
        raise RuntimeError(&#34;Failed to connect to FreeCAD&#34;)

    # æ‰“å¼€æ–‡ä»¶
    self.log(f&#34;Opening file: {file_path}&#34;)
    if not self.connector.open_document(file_path):
        raise RuntimeError(f&#34;Failed to open file: {file_path}&#34;)

    # æ˜¾ç¤ºå¯ç”¨å‚æ•°
    self.log(&#34;\nAvailable parameters:&#34;)
    params = self.connector.get_parameters()
    for p in params[:5]:  # æ˜¾ç¤ºå‰5ä¸ª
        self.log(f&#34;  - {p.name} = {p.value} {p.unit}&#34;)

    # æ£€æŸ¥ç›®æ ‡å‚æ•°æ˜¯å¦å­˜åœ¨
    target_param = self.connector.find_parameter(param_name)
    if not target_param:
        if params:
            self.log(f&#34;[Warning] Parameter &#39;{param_name}&#39; not found, available parameters:&#34;)
            for p in params[:10]:  # æ˜¾ç¤ºå‰10ä¸ªå‚æ•°
                self.log(f&#34;  - {p.name} = {p.value} {p.unit}&#34;)
            raise ValueError(
                f&#34;Parameter &#39;{param_name}&#39; not found. Please select from the available parameters above.&#34;
            )
        else:
            raise ValueError(
                f&#34;Parameter &#39;{param_name}&#39; not found, and no parameters were found in the model.&#34;
            )

    # åˆ›å»ºè¾“å‡ºç›®å½•
    output_path = Path(output_dir)
    output_path.mkdir(parents=True, exist_ok=True)

    # ç”Ÿæˆå‚æ•°åºåˆ—
    min_val, max_val = param_range
    if steps == 1:
        values = [min_val]
    elif step_mode == &#34;linear&#34;:
        # çº¿æ€§æ­¥è¿›
        step_size = (max_val - min_val) / (steps - 1)
        values = [min_val + i * step_size for i in range(steps)]
    else:  # geometric
        # ç­‰æ¯”æ­¥è¿›
        import math

        ratio = math.exp(math.log(max_val / min_val) / (steps - 1))
        values = [min_val * (ratio ** i) for i in range(steps)]

    self.log(f&#34;\nStarting optimization for parameter: {param_name}&#34;)
    self.log(f&#34;   Range: {min_val} ~ {max_val} mm&#34;)
    self.log(f&#34;   Steps: {steps}&#34;)
    self.log(f&#34;   Step mode: {step_mode}&#34;)
    self.log(f&#34;   Value sequence: {[round(v, 2) for v in values]}&#34;)
    self.log(&#34;-&#34; * 60)

    # ä¼˜åŒ–å¾ªç¯
    for i, value in enumerate(values, 1):
        iteration_start = time.time()

        self.log(f&#34;\n[Iteration {i}/{steps}] {param_name} = {value:.2f} mm&#34;)

        try:
            # 1. è®¾ç½®å‚æ•°
            self.log(&#34;   Modifying parameter...&#34;)
            if not self.connector.set_parameter(param_name, value):
                self.log(&#34;   Parameter setting failed, skipping&#34;)
                continue

            # 2. é‡å»ºæ¨¡å‹
            self.log(&#34;   Rebuilding model...&#34;)
            if not self.connector.rebuild():
                self.log(&#34;   Warning: Rebuild may have issues&#34;)

            # 3. å¯¼å‡ºæ–‡ä»¶
            export_file = (
                output_path / f&#34;iter_{i:02d}_{param_name}_{value:.1f}.step&#34;
            )
            self.log(f&#34;   Exporting: {export_file.name}&#34;)

            if not self.connector.export_file(str(export_file), &#34;STEP&#34;):
                self.log(&#34;   Export failed&#34;)
                continue

            # 4. åˆ†æè´¨é‡ï¼ˆå¦‚æœå¯ç”¨ï¼‰
            quality_score = 50.0  # åŸºç¡€åˆ†
            allowable_stress = 0.0
            safety_factor = 0.0
            notes = &#34;Not analyzed&#34;

            if analyze_geometry and export_file.exists():
                self.log(&#34;   Analyzing geometry quality...&#34;)
                try:
                    from sw_helper.geometry.parser import GeometryParser

                    parser = GeometryParser()
                    geo_data = parser.parse(str(export_file))

                    # è®¡ç®—è´¨é‡åˆ†æ•°
                    quality_score = self._calculate_quality_score(geo_data, value)

                    # è®¡ç®—åŠ›å­¦æ€§èƒ½
                    allowable_stress, safety_factor = self._calculate_mechanical_properties(
                        geo_data, value
                    )

                    notes = f&#34;Volume: {geo_data.get(&#39;volume&#39;, 0):.2e} mÂ³&#34;
                except Exception as e:
                    self.log(f&#34;   Analysis failed: {e}&#34;)
                    notes = f&#34;Analysis failed: {e}&#34;
            else:
                notes = &#34;Not analyzed&#34;
                # æ¨¡æ‹Ÿè´¨é‡åˆ†æ•°å’ŒåŠ›å­¦æ€§èƒ½ï¼ˆç”¨äºæµ‹è¯•ï¼‰
                quality_score = 50 + (value - min_val) / (max_val - min_val) * 40
                if param_name.lower() in [&#34;fillet&#34;, &#34;radius&#34;, &#34;r&#34;]:
                    # åœ†è§’åŠå¾„åœ¨é€‚ä¸­èŒƒå›´å¾—åˆ†é«˜
                    optimal = (min_val + max_val) / 2
                    quality_score = (
                        100 - abs(value - optimal) / (max_val - min_val) * 50
                    )

                # æ¨¡æ‹ŸåŠ›å­¦æ€§èƒ½
                allowable_stress, safety_factor = self._calculate_mechanical_properties(
                    {}, value
                )

            analysis_time = time.time() - iteration_start

            # è®°å½•ç»“æœ
            result = OptimizationResult(
                iteration=i,
                parameter_name=param_name,
                parameter_value=value,
                quality_score=quality_score,
                allowable_stress=allowable_stress,
                safety_factor=safety_factor,
                analysis_time=analysis_time,
                timestamp=datetime.now().isoformat(),
                notes=notes,
                export_path=str(export_file),
            )

            self.results.append(result)

            self.log(f&#34;   Quality score: {quality_score:.1f}/100&#34;)
            self.log(f&#34;   Time elapsed: {analysis_time:.2f}s&#34;)

        except Exception as e:
            self.log(f&#34;   âœ— é”™è¯¯: {e}&#34;)
            import traceback

            traceback.print_exc()
            continue

    # å…³é—­æ–‡æ¡£
    self.log(&#34;\nClosing document...&#34;)
    self.connector.close_document(save=False)
    self.connector.disconnect()

    # ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
    if self.results:
        self._generate_summary()

    return self.results</code></pre>
</details>
<div class="desc"><p>ä¼˜åŒ–æŒ‡å®šå‚æ•°</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>file_path</code></strong></dt>
<dd>CADæ–‡ä»¶è·¯å¾„(.FCStd)</dd>
<dt><strong><code>param_name</code></strong></dt>
<dd>å‚æ•°å(å¦‚"Fillet_Radius")</dd>
<dt><strong><code>param_range</code></strong></dt>
<dd>(æœ€å°å€¼, æœ€å¤§å€¼)</dd>
<dt><strong><code>steps</code></strong></dt>
<dd>è¿­ä»£æ­¥æ•°</dd>
<dt><strong><code>step_mode</code></strong></dt>
<dd>æ­¥è¿›æ¨¡å¼ (linear/geometric)</dd>
<dt><strong><code>output_dir</code></strong></dt>
<dd>è¾“å‡ºç›®å½•</dd>
<dt><strong><code>analyze_geometry</code></strong></dt>
<dd>æ˜¯å¦åˆ†æå‡ ä½•è´¨é‡</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>ä¼˜åŒ–ç»“æœåˆ—è¡¨</p></div>
</dd>
<dt id="sw_helper.optimization.FreeCADOptimizer.plot_results"><code class="name flex">
<span>def <span class="ident">plot_results</span></span>(<span>self, output_file:Â strÂ =Â 'optimization_plot.png')</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_results(self, output_file: str = &#34;optimization_plot.png&#34;):
    &#34;&#34;&#34;ç»˜åˆ¶ä¼˜åŒ–ç»“æœå›¾è¡¨&#34;&#34;&#34;
    try:
        import matplotlib.pyplot as plt
        import matplotlib

        matplotlib.use(&#34;Agg&#34;)  # éäº¤äº’å¼åç«¯

        values = [r.parameter_value for r in self.results]
        scores = [r.quality_score for r in self.results]
        allowable_stresses = [r.allowable_stress for r in self.results]
        safety_factors = [r.safety_factor for r in self.results]

        fig, (ax1, ax2, ax3) = plt.subplots(3, 1, figsize=(10, 12), sharex=True)

        # å›¾1: è´¨é‡åˆ†æ•° vs å‚æ•°å€¼
        ax1.plot(values, scores, &#34;b-o&#34;, linewidth=2, markersize=8)
        ax1.set_xlabel(&#34;Parameter Value (mm)&#34;, fontsize=12)
        ax1.set_ylabel(&#34;Quality Score&#34;, fontsize=12)
        ax1.set_title(&#34;Quality Score vs Parameter Value&#34;, fontsize=14, pad=10)
        ax1.grid(True, alpha=0.3)
        ax1.set_ylim(0, 100)

        # æ ‡è®°æœ€ä½³ç‚¹
        best_idx = scores.index(max(scores))
        ax1.plot(
            values[best_idx],
            scores[best_idx],
            &#34;r*&#34;,
            markersize=20,
            label=&#34;Best&#34;,
        )
        ax1.legend()

        # å›¾2: è®¸ç”¨åº”åŠ› vs å‚æ•°å€¼
        ax2.plot(values, allowable_stresses, &#34;g-s&#34;, linewidth=2, markersize=8)
        ax2.set_xlabel(&#34;Parameter Value (mm)&#34;, fontsize=12)
        ax2.set_ylabel(&#34;Allowable Stress (MPa)&#34;, fontsize=12)
        ax2.set_title(&#34;Allowable Stress vs Parameter Value&#34;, fontsize=14, pad=10)
        ax2.grid(True, alpha=0.3)

        # æ ‡è®°æœ€ä½³ç‚¹
        ax2.plot(
            values[best_idx],
            allowable_stresses[best_idx],
            &#34;r*&#34;,
            markersize=20,
            label=&#34;Best&#34;,
        )
        ax2.legend()

        # å›¾3: å®‰å…¨ç³»æ•° vs å‚æ•°å€¼
        ax3.plot(values, safety_factors, &#34;m-^&#34;, linewidth=2, markersize=8)
        ax3.set_xlabel(&#34;Parameter Value (mm)&#34;, fontsize=12)
        ax3.set_ylabel(&#34;Safety Factor&#34;, fontsize=12)
        ax3.set_title(&#34;Safety Factor vs Parameter Value&#34;, fontsize=14, pad=10)
        ax3.grid(True, alpha=0.3)

        # æ ‡è®°æœ€ä½³ç‚¹
        ax3.plot(
            values[best_idx],
            safety_factors[best_idx],
            &#34;r*&#34;,
            markersize=20,
            label=&#34;Best&#34;,
        )
        ax3.legend()

        plt.tight_layout()
        plt.savefig(output_file, dpi=300, bbox_inches=&#34;tight&#34;)
        plt.close()

        self.log(f&#34;Plot saved: {output_file}&#34;)

    except ImportError:
        self.log(&#34;matplotlib not installed, skipping plot&#34;)
    except Exception as e:
        self.log(f&#34;Plot failed: {e}&#34;)</code></pre>
</details>
<div class="desc"><p>ç»˜åˆ¶ä¼˜åŒ–ç»“æœå›¾è¡¨</p></div>
</dd>
<dt id="sw_helper.optimization.FreeCADOptimizer.set_progress_callback"><code class="name flex">
<span>def <span class="ident">set_progress_callback</span></span>(<span>self, callback:Â Callable[[str],Â None])</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_progress_callback(self, callback: Callable[[str], None]):
    &#34;&#34;&#34;è®¾ç½®è¿›åº¦å›è°ƒå‡½æ•°&#34;&#34;&#34;
    self.progress_callback = callback</code></pre>
</details>
<div class="desc"><p>è®¾ç½®è¿›åº¦å›è°ƒå‡½æ•°</p></div>
</dd>
</dl>
</dd>
<dt id="sw_helper.optimization.OptimizationConfig"><code class="flex name class">
<span>class <span class="ident">OptimizationConfig</span></span>
<span>(</span><span>target_parameter:Â str,<br>parameter_range:Â tuple,<br>step_size:Â float,<br>iterations:Â int,<br>target_metric:Â str,<br>target_value:Â floatÂ |Â NoneÂ =Â None,<br>minimize:Â boolÂ =Â True)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class OptimizationConfig:
    &#34;&#34;&#34;ä¼˜åŒ–é…ç½®&#34;&#34;&#34;

    target_parameter: str
    parameter_range: tuple  # (min, max)
    step_size: float
    iterations: int
    target_metric: str  # å¦‚ &#39;max_stress&#39;, &#39;safety_factor&#39;
    target_value: Optional[float] = None
    minimize: bool = True</code></pre>
</details>
<div class="desc"><p>ä¼˜åŒ–é…ç½®</p></div>
<h3>Instance variables</h3>
<dl>
<dt id="sw_helper.optimization.OptimizationConfig.iterations"><code class="name">var <span class="ident">iterations</span> :Â int</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationConfig.minimize"><code class="name">var <span class="ident">minimize</span> :Â bool</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationConfig.parameter_range"><code class="name">var <span class="ident">parameter_range</span> :Â tuple</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationConfig.step_size"><code class="name">var <span class="ident">step_size</span> :Â float</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationConfig.target_metric"><code class="name">var <span class="ident">target_metric</span> :Â str</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationConfig.target_parameter"><code class="name">var <span class="ident">target_parameter</span> :Â str</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationConfig.target_value"><code class="name">var <span class="ident">target_value</span> :Â floatÂ |Â None</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
</dl>
</dd>
<dt id="sw_helper.optimization.OptimizationResult"><code class="flex name class">
<span>class <span class="ident">OptimizationResult</span></span>
<span>(</span><span>iteration:Â int,<br>parameters:Â Dict[str,Â float],<br>quality_score:Â float,<br>analysis_time:Â float,<br>timestamp:Â str,<br>notes:Â strÂ =Â '')</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class OptimizationResult:
    &#34;&#34;&#34;ä¼˜åŒ–ç»“æœæ•°æ®ç±»&#34;&#34;&#34;

    iteration: int
    parameters: Dict[str, float]
    quality_score: float
    analysis_time: float
    timestamp: str
    notes: str = &#34;&#34;</code></pre>
</details>
<div class="desc"><p>ä¼˜åŒ–ç»“æœæ•°æ®ç±»</p></div>
<h3>Instance variables</h3>
<dl>
<dt id="sw_helper.optimization.OptimizationResult.analysis_time"><code class="name">var <span class="ident">analysis_time</span> :Â float</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.iteration"><code class="name">var <span class="ident">iteration</span> :Â int</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.notes"><code class="name">var <span class="ident">notes</span> :Â str</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.parameters"><code class="name">var <span class="ident">parameters</span> :Â Dict[str,Â float]</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.quality_score"><code class="name">var <span class="ident">quality_score</span> :Â float</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.timestamp"><code class="name">var <span class="ident">timestamp</span> :Â str</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
</dl>
</dd>
<dt id="sw_helper.optimization.OptimizationResult"><code class="flex name class">
<span>class <span class="ident">FCOptimizationResult</span></span>
<span>(</span><span>iteration:Â int,<br>parameter_name:Â str,<br>parameter_value:Â float,<br>quality_score:Â float,<br>analysis_time:Â float,<br>timestamp:Â str,<br>allowable_stress:Â floatÂ =Â 0.0,<br>safety_factor:Â floatÂ =Â 0.0,<br>notes:Â strÂ =Â '',<br>export_path:Â strÂ =Â '')</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class OptimizationResult:
    &#34;&#34;&#34;ä¼˜åŒ–ç»“æœæ•°æ®ç±» - åŒ…å«æ›´è¯¦ç»†çš„ä¿¡æ¯&#34;&#34;&#34;

    iteration: int
    parameter_name: str
    parameter_value: float
    quality_score: float
    analysis_time: float
    timestamp: str
    allowable_stress: float = 0.0
    safety_factor: float = 0.0
    notes: str = &#34;&#34;
    export_path: str = &#34;&#34;</code></pre>
</details>
<div class="desc"><p>ä¼˜åŒ–ç»“æœæ•°æ®ç±» - åŒ…å«æ›´è¯¦ç»†çš„ä¿¡æ¯</p></div>
<h3>Instance variables</h3>
<dl>
<dt id="sw_helper.optimization.OptimizationResult.allowable_stress"><code class="name">var <span class="ident">allowable_stress</span> :Â float</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.analysis_time"><code class="name">var <span class="ident">analysis_time</span> :Â float</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.export_path"><code class="name">var <span class="ident">export_path</span> :Â str</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.iteration"><code class="name">var <span class="ident">iteration</span> :Â int</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.notes"><code class="name">var <span class="ident">notes</span> :Â str</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.parameter_name"><code class="name">var <span class="ident">parameter_name</span> :Â str</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.parameter_value"><code class="name">var <span class="ident">parameter_value</span> :Â float</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.quality_score"><code class="name">var <span class="ident">quality_score</span> :Â float</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.safety_factor"><code class="name">var <span class="ident">safety_factor</span> :Â float</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
<dt id="sw_helper.optimization.OptimizationResult.timestamp"><code class="name">var <span class="ident">timestamp</span> :Â str</code></dt>
<dd>
<div class="desc"><p>The type of the None singleton.</p></div>
</dd>
</dl>
</dd>
<dt id="sw_helper.optimization.ParametricOptimizer"><code class="flex name class">
<span>class <span class="ident">ParametricOptimizer</span></span>
<span>(</span><span>cad_connector=None)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ParametricOptimizer:
    &#34;&#34;&#34;å‚æ•°ä¼˜åŒ–å™¨&#34;&#34;&#34;

    def __init__(self, cad_connector=None):
        self.cad = cad_connector
        self.results: List[OptimizationResult] = []
        self.callback: Optional[Callable] = None

    def set_callback(self, callback: Callable):
        &#34;&#34;&#34;è®¾ç½®è¿›åº¦å›è°ƒå‡½æ•°&#34;&#34;&#34;
        self.callback = callback

    def optimize_fillet_radius(
        self,
        file_path: str,
        radius_range: tuple = (2, 15),
        steps: int = 5,
        cad_type: str = &#34;solidworks&#34;,
    ) -&gt; List[OptimizationResult]:
        &#34;&#34;&#34;
        ä¼˜åŒ–åœ†è§’åŠå¾„

        å·¥ä½œæµç¨‹:
        1. ä¿®æ”¹åœ†è§’åŠå¾„å‚æ•°
        2. é‡å»ºæ¨¡å‹
        3. å¯¼å‡ºSTEPæ–‡ä»¶
        4. åˆ†æè´¨é‡
        5. è®°å½•ç»“æœ

        Args:
            file_path: CADæ–‡ä»¶è·¯å¾„
            radius_range: åœ†è§’åŠå¾„èŒƒå›´ (min, max) mm
            steps: è¿­ä»£æ¬¡æ•°
            cad_type: CADè½¯ä»¶ç±»å‹

        Returns:
            ä¼˜åŒ–ç»“æœåˆ—è¡¨
        &#34;&#34;&#34;
        from sw_helper.integrations.cad_connector import CADManager
        from sw_helper.geometry.parser import GeometryParser

        self.results = []

        # è¿æ¥CAD
        if not self.cad:
            manager = CADManager()
            cad_name = manager.auto_connect()
            if not cad_name:
                raise RuntimeError(&#34;æ— æ³•è¿æ¥åˆ°CADè½¯ä»¶&#34;)
            self.cad = manager.get_connector()

        # æ‰“å¼€æ–‡ä»¶
        if not self.cad.open_document(file_path):
            raise RuntimeError(f&#34;æ— æ³•æ‰“å¼€æ–‡ä»¶: {file_path}&#34;)

        # ç”ŸæˆåŠå¾„åºåˆ—
        min_r, max_r = radius_range
        radii = [min_r + (max_r - min_r) * i / (steps - 1) for i in range(steps)]

        # è·å–ç¼–ç åŠ©æ‰‹å®ä¾‹
        encoding_helper = get_encoding_helper()

        def console_print(msg):
            formatted_msg = encoding_helper.format_text(msg)
            if not self.callback:
                print(formatted_msg)
            else:
                self.callback(formatted_msg)

        console_print(f&#34;å¼€å§‹ä¼˜åŒ–åœ†è§’åŠå¾„: {radius_range[0]} ~ {radius_range[1]} mm&#34;)
        console_print(f&#34;è¿­ä»£æ¬¡æ•°: {steps}&#34;)
        console_print(&#34;-&#34; * 60)

        for i, radius in enumerate(radii):
            iteration_start = time.time()

            console_print(f&#34;\n[è¿­ä»£ {i + 1}/{steps}] åœ†è§’ R = {radius:.2f} mm&#34;)

            try:
                # 1. ä¿®æ”¹å‚æ•°
                if cad_type.lower() == &#34;solidworks&#34;:
                    # SolidWorkså‚æ•°åå¯èƒ½æ˜¯ &#34;Fillet_R&#34; æˆ–ç±»ä¼¼çš„
                    param_names = [&#34;Fillet_R&#34;, &#34;Fillet_Radius&#34;, &#34;R&#34;, &#34;åœ†è§’åŠå¾„&#34;]
                    param_set = False

                    for param_name in param_names:
                        if self.cad.set_parameter(param_name, radius):
                            console_print(f&#34;  âœ“ è®¾ç½®å‚æ•°: {param_name} = {radius} mm&#34;)
                            param_set = True
                            break

                    if not param_set:
                        console_print(&#34;  âš  è­¦å‘Š: æœªèƒ½æ‰¾åˆ°åœ†è§’å‚æ•°ï¼Œå°è¯•ä½¿ç”¨ç‰¹å¾åç§°&#34;)
                        # å¯ä»¥å°è¯•é€šè¿‡ç‰¹å¾åç§°ä¿®æ”¹
                else:
                    # FreeCAD
                    self.cad.set_parameter(&#34;Fillet_Radius&#34;, radius)

                # 2. é‡å»ºæ¨¡å‹
                console_print(&#34;  â³ é‡å»ºæ¨¡å‹...&#34;)
                if self.cad.rebuild():
                    console_print(&#34;  âœ“ é‡å»ºå®Œæˆ&#34;)
                else:
                    console_print(&#34;  âš  é‡å»ºå¯èƒ½æœ‰é—®é¢˜&#34;)

                # 3. å¯¼å‡ºæ–‡ä»¶
                export_path = Path(&#34;temp&#34;) / f&#34;opt_iter_{i + 1}_r{radius:.1f}.step&#34;
                export_path.parent.mkdir(exist_ok=True)

                console_print(f&#34;  â³ å¯¼å‡ºåˆ°: {export_path}&#34;)
                if self.cad.export_file(str(export_path), &#34;STEP&#34;):
                    console_print(&#34;  âœ“ å¯¼å‡ºæˆåŠŸ&#34;)
                else:
                    console_print(&#34;  âœ— å¯¼å‡ºå¤±è´¥&#34;)
                    continue

                # 4. åˆ†æå‡ ä½•è´¨é‡
                console_print(&#34;  â³ åˆ†æå‡ ä½•è´¨é‡...&#34;)
                parser = GeometryParser()
                geo_data = parser.parse(str(export_path))

                # è®¡ç®—è´¨é‡åˆ†æ•°ï¼ˆæ¨¡æ‹Ÿï¼‰
                quality_score = self._calculate_quality_score(geo_data, radius)

                analysis_time = time.time() - iteration_start

                # 5. è®°å½•ç»“æœ
                result = OptimizationResult(
                    iteration=i + 1,
                    parameters={&#34;fillet_radius&#34;: radius},
                    quality_score=quality_score,
                    analysis_time=analysis_time,
                    timestamp=datetime.now().isoformat(),
                    notes=f&#34;ä½“ç§¯: {geo_data.get(&#39;volume&#39;, 0):.2e} mÂ³&#34;,
                )

                self.results.append(result)

                console_print(f&#34;  âœ“ è´¨é‡åˆ†æ•°: {quality_score:.2f}&#34;)
                console_print(f&#34;  â±  è€—æ—¶: {analysis_time:.2f}s&#34;)

            except Exception as e:
                console_print(f&#34;  âœ— é”™è¯¯: {e}&#34;)
                continue

        # å…³é—­CADæ–‡æ¡£
        self.cad.close_document(save=False)

        # ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š
        self._generate_optimization_report()

        return self.results

    def _calculate_quality_score(self, geo_data: Dict, radius: float) -&gt; float:
        &#34;&#34;&#34;è®¡ç®—è´¨é‡åˆ†æ•°&#34;&#34;&#34;
        # è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„è´¨é‡è¯„åˆ†å‡½æ•°
        # å®é™…åº”æ ¹æ®åº”åŠ›åˆ†æã€åˆ¶é€ å·¥è‰ºç­‰å› ç´ è®¡ç®—

        score = 50.0  # åŸºç¡€åˆ†

        # åœ†è§’åŠå¾„é€‚ä¸­åŠ åˆ†ï¼ˆé¿å…åº”åŠ›é›†ä¸­ï¼‰
        if 3 &lt;= radius &lt;= 10:
            score += 20
        elif radius &gt; 10:
            score += 10
        else:
            score += 5

        # ä½“ç§¯åˆç†åŠ åˆ†ï¼ˆä¸è¿‡å¤§ï¼‰
        volume = geo_data.get(&#34;volume&#34;, 0)
        if volume &lt; 0.001:  # å°äº1å‡
            score += 15

        # å‡ ä½•å¤æ‚åº¦ï¼ˆé¡¶ç‚¹æ•°ï¼‰
        vertices = geo_data.get(&#34;vertices&#34;, 0)
        if 100 &lt; vertices &lt; 10000:
            score += 15

        return min(100, score)

    def optimize_parameter(
        self, file_path: str, config: OptimizationConfig, cad_type: str = &#34;solidworks&#34;
    ) -&gt; List[OptimizationResult]:
        &#34;&#34;&#34;
        é€šç”¨å‚æ•°ä¼˜åŒ–

        Args:
            file_path: CADæ–‡ä»¶è·¯å¾„
            config: ä¼˜åŒ–é…ç½®
            cad_type: CADè½¯ä»¶ç±»å‹

        Returns:
            ä¼˜åŒ–ç»“æœåˆ—è¡¨
        &#34;&#34;&#34;
        self.results = []

        # è¿æ¥CAD
        from sw_helper.integrations.cad_connector import CADManager

        if not self.cad:
            manager = CADManager()
            cad_name = manager.auto_connect()
            if not cad_name:
                raise RuntimeError(&#34;æ— æ³•è¿æ¥åˆ°CADè½¯ä»¶&#34;)
            self.cad = manager.get_connector()

        # æ‰“å¼€æ–‡ä»¶
        if not self.cad.open_document(file_path):
            raise RuntimeError(f&#34;æ— æ³•æ‰“å¼€æ–‡ä»¶: {file_path}&#34;)

        # ç”Ÿæˆå‚æ•°åºåˆ—
        min_val, max_val = config.parameter_range
        if config.iterations == 1:
            values = [min_val]
        else:
            step = (max_val - min_val) / (config.iterations - 1)
            values = [min_val + i * step for i in range(config.iterations)]

        print(f&#34;å¼€å§‹ä¼˜åŒ–å‚æ•° &#39;{config.target_parameter}&#39;&#34;)
        print(f&#34;èŒƒå›´: {min_val} ~ {max_val}, æ­¥é•¿: {config.step_size}&#34;)
        print(&#34;-&#34; * 60)

        for i, value in enumerate(values):
            iteration_start = time.time()

            print(
                f&#34;\n[è¿­ä»£ {i + 1}/{config.iterations}] {config.target_parameter} = {value:.4f}&#34;
            )

            try:
                # ä¿®æ”¹å‚æ•°
                if self.cad.set_parameter(config.target_parameter, value):
                    print(&#34;  âœ“ å‚æ•°è®¾ç½®æˆåŠŸ&#34;)
                else:
                    print(&#34;  âœ— å‚æ•°è®¾ç½®å¤±è´¥&#34;)
                    continue

                # é‡å»º
                print(&#34;  â³ é‡å»ºæ¨¡å‹...&#34;)
                self.cad.rebuild()

                # å¯¼å‡º
                export_path = Path(&#34;temp&#34;) / f&#34;opt_{i + 1}.step&#34;
                self.cad.export_file(str(export_path), &#34;STEP&#34;)

                # åˆ†æï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
                quality_score = 50 + (value - min_val) / (max_val - min_val) * 50

                analysis_time = time.time() - iteration_start

                result = OptimizationResult(
                    iteration=i + 1,
                    parameters={config.target_parameter: value},
                    quality_score=quality_score,
                    analysis_time=analysis_time,
                    timestamp=datetime.now().isoformat(),
                )

                self.results.append(result)
                print(f&#34;  âœ“ è´¨é‡åˆ†æ•°: {quality_score:.2f}&#34;)

            except Exception as e:
                print(f&#34;  âœ— é”™è¯¯: {e}&#34;)
                continue

        self.cad.close_document(save=False)
        return self.results

    def _generate_optimization_report(self) -&gt; str:
        &#34;&#34;&#34;ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š&#34;&#34;&#34;
        if not self.results:
            return &#34;&#34;

        report_lines = [
            &#34;=&#34; * 60,
            &#34;å‚æ•°ä¼˜åŒ–æŠ¥å‘Š&#34;,
            &#34;=&#34; * 60,
            f&#34;ç”Ÿæˆæ—¶é—´: {datetime.now().strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)}&#34;,
            f&#34;æ€»è¿­ä»£æ¬¡æ•°: {len(self.results)}&#34;,
            &#34;&#34;,
            &#34;ä¼˜åŒ–ç»“æœ:&#34;,
            &#34;-&#34; * 60,
        ]

        best_result = max(self.results, key=lambda x: x.quality_score)

        for result in self.results:
            params_str = &#34;, &#34;.join(
                [f&#34;{k}={v:.2f}&#34; for k, v in result.parameters.items()]
            )
            marker = &#34; â˜… æœ€ä½³&#34; if result == best_result else &#34;&#34;
            report_lines.append(
                f&#34;è¿­ä»£ {result.iteration}: {params_str} | &#34;
                f&#34;è´¨é‡åˆ†æ•°: {result.quality_score:.2f} | &#34;
                f&#34;è€—æ—¶: {result.analysis_time:.2f}s{marker}&#34;
            )

        report_lines.extend(
            [
                &#34;&#34;,
                &#34;=&#34; * 60,
                &#34;æœ€ä½³ç»“æœ:&#34;,
                &#34;-&#34; * 60,
                f&#34;è¿­ä»£: {best_result.iteration}&#34;,
            ]
        )

        for param_name, value in best_result.parameters.items():
            report_lines.append(f&#34;{param_name}: {value:.4f}&#34;)

        report_lines.extend(
            [
                f&#34;è´¨é‡åˆ†æ•°: {best_result.quality_score:.2f}&#34;,
                f&#34;æ€»è€—æ—¶: {sum(r.analysis_time for r in self.results):.2f}s&#34;,
                &#34;=&#34; * 60,
            ]
        )

        report = &#34;\n&#34;.join(report_lines)

        # ä¿å­˜æŠ¥å‘Š
        report_path = Path(&#34;temp&#34;) / f&#34;optimization_report_{int(time.time())}.txt&#34;
        report_path.parent.mkdir(exist_ok=True)
        with open(report_path, &#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
            f.write(report)

        print(f&#34;\næŠ¥å‘Šå·²ä¿å­˜: {report_path}&#34;)

        return report

    def export_results_json(self, output_path: str):
        &#34;&#34;&#34;å¯¼å‡ºç»“æœä¸ºJSON&#34;&#34;&#34;
        data = {
            &#34;optimization_type&#34;: &#34;parametric&#34;,
            &#34;timestamp&#34;: datetime.now().isoformat(),
            &#34;results&#34;: [asdict(r) for r in self.results],
        }

        with open(output_path, &#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
            json.dump(data, f, indent=2, ensure_ascii=False)

        print(f&#34;ç»“æœå·²å¯¼å‡º: {output_path}&#34;)

    def plot_results(self):
        &#34;&#34;&#34;ç»˜åˆ¶ä¼˜åŒ–ç»“æœå›¾è¡¨&#34;&#34;&#34;
        try:
            import matplotlib.pyplot as plt

            iterations = [r.iteration for r in self.results]
            scores = [r.quality_score for r in self.results]

            plt.figure(figsize=(10, 6))
            plt.plot(iterations, scores, &#34;b-o&#34;, linewidth=2, markersize=8)
            plt.xlabel(&#34;è¿­ä»£æ¬¡æ•°&#34;, fontsize=12)
            plt.ylabel(&#34;è´¨é‡åˆ†æ•°&#34;, fontsize=12)
            plt.title(&#34;å‚æ•°ä¼˜åŒ–è¿­ä»£è¿‡ç¨‹&#34;, fontsize=14)
            plt.grid(True, alpha=0.3)

            # æ ‡è®°æœ€ä½³ç‚¹
            best_idx = scores.index(max(scores))
            plt.plot(
                iterations[best_idx],
                scores[best_idx],
                &#34;r*&#34;,
                markersize=15,
                label=&#34;æœ€ä½³&#34;,
            )
            plt.legend()

            plt.tight_layout()
            plt.savefig(&#34;temp/optimization_plot.png&#34;, dpi=150)
            plt.close()

            print(&#34;å›¾è¡¨å·²ä¿å­˜: temp/optimization_plot.png&#34;)

        except ImportError:
            print(&#34;è­¦å‘Š: æœªå®‰è£…matplotlibï¼Œæ— æ³•ç»˜åˆ¶å›¾è¡¨&#34;)</code></pre>
</details>
<div class="desc"><p>å‚æ•°ä¼˜åŒ–å™¨</p></div>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="sw_helper.optimization.parametric.AIAssistedOptimizer" href="parametric.html#sw_helper.optimization.parametric.AIAssistedOptimizer">AIAssistedOptimizer</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="sw_helper.optimization.ParametricOptimizer.export_results_json"><code class="name flex">
<span>def <span class="ident">export_results_json</span></span>(<span>self, output_path:Â str)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def export_results_json(self, output_path: str):
    &#34;&#34;&#34;å¯¼å‡ºç»“æœä¸ºJSON&#34;&#34;&#34;
    data = {
        &#34;optimization_type&#34;: &#34;parametric&#34;,
        &#34;timestamp&#34;: datetime.now().isoformat(),
        &#34;results&#34;: [asdict(r) for r in self.results],
    }

    with open(output_path, &#34;w&#34;, encoding=&#34;utf-8&#34;) as f:
        json.dump(data, f, indent=2, ensure_ascii=False)

    print(f&#34;ç»“æœå·²å¯¼å‡º: {output_path}&#34;)</code></pre>
</details>
<div class="desc"><p>å¯¼å‡ºç»“æœä¸ºJSON</p></div>
</dd>
<dt id="sw_helper.optimization.ParametricOptimizer.optimize_fillet_radius"><code class="name flex">
<span>def <span class="ident">optimize_fillet_radius</span></span>(<span>self,<br>file_path:Â str,<br>radius_range:Â tupleÂ =Â (2, 15),<br>steps:Â intÂ =Â 5,<br>cad_type:Â strÂ =Â 'solidworks') â€‘>Â List[<a title="sw_helper.optimization.parametric.OptimizationResult" href="parametric.html#sw_helper.optimization.parametric.OptimizationResult">OptimizationResult</a>]</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def optimize_fillet_radius(
    self,
    file_path: str,
    radius_range: tuple = (2, 15),
    steps: int = 5,
    cad_type: str = &#34;solidworks&#34;,
) -&gt; List[OptimizationResult]:
    &#34;&#34;&#34;
    ä¼˜åŒ–åœ†è§’åŠå¾„

    å·¥ä½œæµç¨‹:
    1. ä¿®æ”¹åœ†è§’åŠå¾„å‚æ•°
    2. é‡å»ºæ¨¡å‹
    3. å¯¼å‡ºSTEPæ–‡ä»¶
    4. åˆ†æè´¨é‡
    5. è®°å½•ç»“æœ

    Args:
        file_path: CADæ–‡ä»¶è·¯å¾„
        radius_range: åœ†è§’åŠå¾„èŒƒå›´ (min, max) mm
        steps: è¿­ä»£æ¬¡æ•°
        cad_type: CADè½¯ä»¶ç±»å‹

    Returns:
        ä¼˜åŒ–ç»“æœåˆ—è¡¨
    &#34;&#34;&#34;
    from sw_helper.integrations.cad_connector import CADManager
    from sw_helper.geometry.parser import GeometryParser

    self.results = []

    # è¿æ¥CAD
    if not self.cad:
        manager = CADManager()
        cad_name = manager.auto_connect()
        if not cad_name:
            raise RuntimeError(&#34;æ— æ³•è¿æ¥åˆ°CADè½¯ä»¶&#34;)
        self.cad = manager.get_connector()

    # æ‰“å¼€æ–‡ä»¶
    if not self.cad.open_document(file_path):
        raise RuntimeError(f&#34;æ— æ³•æ‰“å¼€æ–‡ä»¶: {file_path}&#34;)

    # ç”ŸæˆåŠå¾„åºåˆ—
    min_r, max_r = radius_range
    radii = [min_r + (max_r - min_r) * i / (steps - 1) for i in range(steps)]

    # è·å–ç¼–ç åŠ©æ‰‹å®ä¾‹
    encoding_helper = get_encoding_helper()

    def console_print(msg):
        formatted_msg = encoding_helper.format_text(msg)
        if not self.callback:
            print(formatted_msg)
        else:
            self.callback(formatted_msg)

    console_print(f&#34;å¼€å§‹ä¼˜åŒ–åœ†è§’åŠå¾„: {radius_range[0]} ~ {radius_range[1]} mm&#34;)
    console_print(f&#34;è¿­ä»£æ¬¡æ•°: {steps}&#34;)
    console_print(&#34;-&#34; * 60)

    for i, radius in enumerate(radii):
        iteration_start = time.time()

        console_print(f&#34;\n[è¿­ä»£ {i + 1}/{steps}] åœ†è§’ R = {radius:.2f} mm&#34;)

        try:
            # 1. ä¿®æ”¹å‚æ•°
            if cad_type.lower() == &#34;solidworks&#34;:
                # SolidWorkså‚æ•°åå¯èƒ½æ˜¯ &#34;Fillet_R&#34; æˆ–ç±»ä¼¼çš„
                param_names = [&#34;Fillet_R&#34;, &#34;Fillet_Radius&#34;, &#34;R&#34;, &#34;åœ†è§’åŠå¾„&#34;]
                param_set = False

                for param_name in param_names:
                    if self.cad.set_parameter(param_name, radius):
                        console_print(f&#34;  âœ“ è®¾ç½®å‚æ•°: {param_name} = {radius} mm&#34;)
                        param_set = True
                        break

                if not param_set:
                    console_print(&#34;  âš  è­¦å‘Š: æœªèƒ½æ‰¾åˆ°åœ†è§’å‚æ•°ï¼Œå°è¯•ä½¿ç”¨ç‰¹å¾åç§°&#34;)
                    # å¯ä»¥å°è¯•é€šè¿‡ç‰¹å¾åç§°ä¿®æ”¹
            else:
                # FreeCAD
                self.cad.set_parameter(&#34;Fillet_Radius&#34;, radius)

            # 2. é‡å»ºæ¨¡å‹
            console_print(&#34;  â³ é‡å»ºæ¨¡å‹...&#34;)
            if self.cad.rebuild():
                console_print(&#34;  âœ“ é‡å»ºå®Œæˆ&#34;)
            else:
                console_print(&#34;  âš  é‡å»ºå¯èƒ½æœ‰é—®é¢˜&#34;)

            # 3. å¯¼å‡ºæ–‡ä»¶
            export_path = Path(&#34;temp&#34;) / f&#34;opt_iter_{i + 1}_r{radius:.1f}.step&#34;
            export_path.parent.mkdir(exist_ok=True)

            console_print(f&#34;  â³ å¯¼å‡ºåˆ°: {export_path}&#34;)
            if self.cad.export_file(str(export_path), &#34;STEP&#34;):
                console_print(&#34;  âœ“ å¯¼å‡ºæˆåŠŸ&#34;)
            else:
                console_print(&#34;  âœ— å¯¼å‡ºå¤±è´¥&#34;)
                continue

            # 4. åˆ†æå‡ ä½•è´¨é‡
            console_print(&#34;  â³ åˆ†æå‡ ä½•è´¨é‡...&#34;)
            parser = GeometryParser()
            geo_data = parser.parse(str(export_path))

            # è®¡ç®—è´¨é‡åˆ†æ•°ï¼ˆæ¨¡æ‹Ÿï¼‰
            quality_score = self._calculate_quality_score(geo_data, radius)

            analysis_time = time.time() - iteration_start

            # 5. è®°å½•ç»“æœ
            result = OptimizationResult(
                iteration=i + 1,
                parameters={&#34;fillet_radius&#34;: radius},
                quality_score=quality_score,
                analysis_time=analysis_time,
                timestamp=datetime.now().isoformat(),
                notes=f&#34;ä½“ç§¯: {geo_data.get(&#39;volume&#39;, 0):.2e} mÂ³&#34;,
            )

            self.results.append(result)

            console_print(f&#34;  âœ“ è´¨é‡åˆ†æ•°: {quality_score:.2f}&#34;)
            console_print(f&#34;  â±  è€—æ—¶: {analysis_time:.2f}s&#34;)

        except Exception as e:
            console_print(f&#34;  âœ— é”™è¯¯: {e}&#34;)
            continue

    # å…³é—­CADæ–‡æ¡£
    self.cad.close_document(save=False)

    # ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š
    self._generate_optimization_report()

    return self.results</code></pre>
</details>
<div class="desc"><p>ä¼˜åŒ–åœ†è§’åŠå¾„</p>
<p>å·¥ä½œæµç¨‹:
1. ä¿®æ”¹åœ†è§’åŠå¾„å‚æ•°
2. é‡å»ºæ¨¡å‹
3. å¯¼å‡ºSTEPæ–‡ä»¶
4. åˆ†æè´¨é‡
5. è®°å½•ç»“æœ</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>file_path</code></strong></dt>
<dd>CADæ–‡ä»¶è·¯å¾„</dd>
<dt><strong><code>radius_range</code></strong></dt>
<dd>åœ†è§’åŠå¾„èŒƒå›´ (min, max) mm</dd>
<dt><strong><code>steps</code></strong></dt>
<dd>è¿­ä»£æ¬¡æ•°</dd>
<dt><strong><code>cad_type</code></strong></dt>
<dd>CADè½¯ä»¶ç±»å‹</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>ä¼˜åŒ–ç»“æœåˆ—è¡¨</p></div>
</dd>
<dt id="sw_helper.optimization.ParametricOptimizer.optimize_parameter"><code class="name flex">
<span>def <span class="ident">optimize_parameter</span></span>(<span>self,<br>file_path:Â str,<br>config:Â <a title="sw_helper.optimization.parametric.OptimizationConfig" href="parametric.html#sw_helper.optimization.parametric.OptimizationConfig">OptimizationConfig</a>,<br>cad_type:Â strÂ =Â 'solidworks') â€‘>Â List[<a title="sw_helper.optimization.parametric.OptimizationResult" href="parametric.html#sw_helper.optimization.parametric.OptimizationResult">OptimizationResult</a>]</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def optimize_parameter(
    self, file_path: str, config: OptimizationConfig, cad_type: str = &#34;solidworks&#34;
) -&gt; List[OptimizationResult]:
    &#34;&#34;&#34;
    é€šç”¨å‚æ•°ä¼˜åŒ–

    Args:
        file_path: CADæ–‡ä»¶è·¯å¾„
        config: ä¼˜åŒ–é…ç½®
        cad_type: CADè½¯ä»¶ç±»å‹

    Returns:
        ä¼˜åŒ–ç»“æœåˆ—è¡¨
    &#34;&#34;&#34;
    self.results = []

    # è¿æ¥CAD
    from sw_helper.integrations.cad_connector import CADManager

    if not self.cad:
        manager = CADManager()
        cad_name = manager.auto_connect()
        if not cad_name:
            raise RuntimeError(&#34;æ— æ³•è¿æ¥åˆ°CADè½¯ä»¶&#34;)
        self.cad = manager.get_connector()

    # æ‰“å¼€æ–‡ä»¶
    if not self.cad.open_document(file_path):
        raise RuntimeError(f&#34;æ— æ³•æ‰“å¼€æ–‡ä»¶: {file_path}&#34;)

    # ç”Ÿæˆå‚æ•°åºåˆ—
    min_val, max_val = config.parameter_range
    if config.iterations == 1:
        values = [min_val]
    else:
        step = (max_val - min_val) / (config.iterations - 1)
        values = [min_val + i * step for i in range(config.iterations)]

    print(f&#34;å¼€å§‹ä¼˜åŒ–å‚æ•° &#39;{config.target_parameter}&#39;&#34;)
    print(f&#34;èŒƒå›´: {min_val} ~ {max_val}, æ­¥é•¿: {config.step_size}&#34;)
    print(&#34;-&#34; * 60)

    for i, value in enumerate(values):
        iteration_start = time.time()

        print(
            f&#34;\n[è¿­ä»£ {i + 1}/{config.iterations}] {config.target_parameter} = {value:.4f}&#34;
        )

        try:
            # ä¿®æ”¹å‚æ•°
            if self.cad.set_parameter(config.target_parameter, value):
                print(&#34;  âœ“ å‚æ•°è®¾ç½®æˆåŠŸ&#34;)
            else:
                print(&#34;  âœ— å‚æ•°è®¾ç½®å¤±è´¥&#34;)
                continue

            # é‡å»º
            print(&#34;  â³ é‡å»ºæ¨¡å‹...&#34;)
            self.cad.rebuild()

            # å¯¼å‡º
            export_path = Path(&#34;temp&#34;) / f&#34;opt_{i + 1}.step&#34;
            self.cad.export_file(str(export_path), &#34;STEP&#34;)

            # åˆ†æï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
            quality_score = 50 + (value - min_val) / (max_val - min_val) * 50

            analysis_time = time.time() - iteration_start

            result = OptimizationResult(
                iteration=i + 1,
                parameters={config.target_parameter: value},
                quality_score=quality_score,
                analysis_time=analysis_time,
                timestamp=datetime.now().isoformat(),
            )

            self.results.append(result)
            print(f&#34;  âœ“ è´¨é‡åˆ†æ•°: {quality_score:.2f}&#34;)

        except Exception as e:
            print(f&#34;  âœ— é”™è¯¯: {e}&#34;)
            continue

    self.cad.close_document(save=False)
    return self.results</code></pre>
</details>
<div class="desc"><p>é€šç”¨å‚æ•°ä¼˜åŒ–</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>file_path</code></strong></dt>
<dd>CADæ–‡ä»¶è·¯å¾„</dd>
<dt><strong><code>config</code></strong></dt>
<dd>ä¼˜åŒ–é…ç½®</dd>
<dt><strong><code>cad_type</code></strong></dt>
<dd>CADè½¯ä»¶ç±»å‹</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>ä¼˜åŒ–ç»“æœåˆ—è¡¨</p></div>
</dd>
<dt id="sw_helper.optimization.ParametricOptimizer.plot_results"><code class="name flex">
<span>def <span class="ident">plot_results</span></span>(<span>self)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_results(self):
    &#34;&#34;&#34;ç»˜åˆ¶ä¼˜åŒ–ç»“æœå›¾è¡¨&#34;&#34;&#34;
    try:
        import matplotlib.pyplot as plt

        iterations = [r.iteration for r in self.results]
        scores = [r.quality_score for r in self.results]

        plt.figure(figsize=(10, 6))
        plt.plot(iterations, scores, &#34;b-o&#34;, linewidth=2, markersize=8)
        plt.xlabel(&#34;è¿­ä»£æ¬¡æ•°&#34;, fontsize=12)
        plt.ylabel(&#34;è´¨é‡åˆ†æ•°&#34;, fontsize=12)
        plt.title(&#34;å‚æ•°ä¼˜åŒ–è¿­ä»£è¿‡ç¨‹&#34;, fontsize=14)
        plt.grid(True, alpha=0.3)

        # æ ‡è®°æœ€ä½³ç‚¹
        best_idx = scores.index(max(scores))
        plt.plot(
            iterations[best_idx],
            scores[best_idx],
            &#34;r*&#34;,
            markersize=15,
            label=&#34;æœ€ä½³&#34;,
        )
        plt.legend()

        plt.tight_layout()
        plt.savefig(&#34;temp/optimization_plot.png&#34;, dpi=150)
        plt.close()

        print(&#34;å›¾è¡¨å·²ä¿å­˜: temp/optimization_plot.png&#34;)

    except ImportError:
        print(&#34;è­¦å‘Š: æœªå®‰è£…matplotlibï¼Œæ— æ³•ç»˜åˆ¶å›¾è¡¨&#34;)</code></pre>
</details>
<div class="desc"><p>ç»˜åˆ¶ä¼˜åŒ–ç»“æœå›¾è¡¨</p></div>
</dd>
<dt id="sw_helper.optimization.ParametricOptimizer.set_callback"><code class="name flex">
<span>def <span class="ident">set_callback</span></span>(<span>self, callback:Â Callable)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_callback(self, callback: Callable):
    &#34;&#34;&#34;è®¾ç½®è¿›åº¦å›è°ƒå‡½æ•°&#34;&#34;&#34;
    self.callback = callback</code></pre>
</details>
<div class="desc"><p>è®¾ç½®è¿›åº¦å›è°ƒå‡½æ•°</p></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="sw_helper" href="../index.html">sw_helper</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="sw_helper.optimization.optimizer" href="optimizer.html">sw_helper.optimization.optimizer</a></code></li>
<li><code><a title="sw_helper.optimization.parametric" href="parametric.html">sw_helper.optimization.parametric</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="sw_helper.optimization.AIAssistedOptimizer" href="#sw_helper.optimization.AIAssistedOptimizer">AIAssistedOptimizer</a></code></h4>
<ul class="">
<li><code><a title="sw_helper.optimization.AIAssistedOptimizer.ai_guided_optimization" href="#sw_helper.optimization.AIAssistedOptimizer.ai_guided_optimization">ai_guided_optimization</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="sw_helper.optimization.FreeCADOptimizer" href="#sw_helper.optimization.FreeCADOptimizer">FreeCADOptimizer</a></code></h4>
<ul class="">
<li><code><a title="sw_helper.optimization.FreeCADOptimizer.connect" href="#sw_helper.optimization.FreeCADOptimizer.connect">connect</a></code></li>
<li><code><a title="sw_helper.optimization.FreeCADOptimizer.export_results" href="#sw_helper.optimization.FreeCADOptimizer.export_results">export_results</a></code></li>
<li><code><a title="sw_helper.optimization.FreeCADOptimizer.generate_report" href="#sw_helper.optimization.FreeCADOptimizer.generate_report">generate_report</a></code></li>
<li><code><a title="sw_helper.optimization.FreeCADOptimizer.log" href="#sw_helper.optimization.FreeCADOptimizer.log">log</a></code></li>
<li><code><a title="sw_helper.optimization.FreeCADOptimizer.optimize_parameter" href="#sw_helper.optimization.FreeCADOptimizer.optimize_parameter">optimize_parameter</a></code></li>
<li><code><a title="sw_helper.optimization.FreeCADOptimizer.plot_results" href="#sw_helper.optimization.FreeCADOptimizer.plot_results">plot_results</a></code></li>
<li><code><a title="sw_helper.optimization.FreeCADOptimizer.set_progress_callback" href="#sw_helper.optimization.FreeCADOptimizer.set_progress_callback">set_progress_callback</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="sw_helper.optimization.OptimizationConfig" href="#sw_helper.optimization.OptimizationConfig">OptimizationConfig</a></code></h4>
<ul class="two-column">
<li><code><a title="sw_helper.optimization.OptimizationConfig.iterations" href="#sw_helper.optimization.OptimizationConfig.iterations">iterations</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationConfig.minimize" href="#sw_helper.optimization.OptimizationConfig.minimize">minimize</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationConfig.parameter_range" href="#sw_helper.optimization.OptimizationConfig.parameter_range">parameter_range</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationConfig.step_size" href="#sw_helper.optimization.OptimizationConfig.step_size">step_size</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationConfig.target_metric" href="#sw_helper.optimization.OptimizationConfig.target_metric">target_metric</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationConfig.target_parameter" href="#sw_helper.optimization.OptimizationConfig.target_parameter">target_parameter</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationConfig.target_value" href="#sw_helper.optimization.OptimizationConfig.target_value">target_value</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="sw_helper.optimization.OptimizationResult" href="#sw_helper.optimization.OptimizationResult">OptimizationResult</a></code></h4>
<ul class="two-column">
<li><code><a title="sw_helper.optimization.OptimizationResult.analysis_time" href="#sw_helper.optimization.OptimizationResult.analysis_time">analysis_time</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.iteration" href="#sw_helper.optimization.OptimizationResult.iteration">iteration</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.notes" href="#sw_helper.optimization.OptimizationResult.notes">notes</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.parameters" href="#sw_helper.optimization.OptimizationResult.parameters">parameters</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.quality_score" href="#sw_helper.optimization.OptimizationResult.quality_score">quality_score</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.timestamp" href="#sw_helper.optimization.OptimizationResult.timestamp">timestamp</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="sw_helper.optimization.OptimizationResult" href="#sw_helper.optimization.OptimizationResult">OptimizationResult</a></code></h4>
<ul class="two-column">
<li><code><a title="sw_helper.optimization.OptimizationResult.allowable_stress" href="#sw_helper.optimization.OptimizationResult.allowable_stress">allowable_stress</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.analysis_time" href="#sw_helper.optimization.OptimizationResult.analysis_time">analysis_time</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.export_path" href="#sw_helper.optimization.OptimizationResult.export_path">export_path</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.iteration" href="#sw_helper.optimization.OptimizationResult.iteration">iteration</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.notes" href="#sw_helper.optimization.OptimizationResult.notes">notes</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.parameter_name" href="#sw_helper.optimization.OptimizationResult.parameter_name">parameter_name</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.parameter_value" href="#sw_helper.optimization.OptimizationResult.parameter_value">parameter_value</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.quality_score" href="#sw_helper.optimization.OptimizationResult.quality_score">quality_score</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.safety_factor" href="#sw_helper.optimization.OptimizationResult.safety_factor">safety_factor</a></code></li>
<li><code><a title="sw_helper.optimization.OptimizationResult.timestamp" href="#sw_helper.optimization.OptimizationResult.timestamp">timestamp</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="sw_helper.optimization.ParametricOptimizer" href="#sw_helper.optimization.ParametricOptimizer">ParametricOptimizer</a></code></h4>
<ul class="">
<li><code><a title="sw_helper.optimization.ParametricOptimizer.export_results_json" href="#sw_helper.optimization.ParametricOptimizer.export_results_json">export_results_json</a></code></li>
<li><code><a title="sw_helper.optimization.ParametricOptimizer.optimize_fillet_radius" href="#sw_helper.optimization.ParametricOptimizer.optimize_fillet_radius">optimize_fillet_radius</a></code></li>
<li><code><a title="sw_helper.optimization.ParametricOptimizer.optimize_parameter" href="#sw_helper.optimization.ParametricOptimizer.optimize_parameter">optimize_parameter</a></code></li>
<li><code><a title="sw_helper.optimization.ParametricOptimizer.plot_results" href="#sw_helper.optimization.ParametricOptimizer.plot_results">plot_results</a></code></li>
<li><code><a title="sw_helper.optimization.ParametricOptimizer.set_callback" href="#sw_helper.optimization.ParametricOptimizer.set_callback">set_callback</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
