# CAE-CLI 知识库功能更新

## 更新内容

### 1. 交互模式菜单扩展
- 将原有的4项菜单扩展为5项菜单：
  1. Analyze Model (分析模型)
  2. Optimize Parameter (参数优化)
  3. AI Generate Model (AI生成模型)
  4. **知识库查询 (Handbook)** - 新增功能
  5. Exit (退出)

### 2. 知识库查询功能实现
- 用户选择菜单项4后，进入知识库查询子界面
- 支持输入关键词查询（如"40Cr"、"M10螺栓"、"圆角"、"公差"、"Q235"等）
- 调用 `knowledge.py` 的 `search_and_display()` 函数
- 使用Rich库美化输出（标题绿色、内容代码块、关键词高亮）
- 支持返回主菜单（输入"back"或直接按Enter）
- 完善的异常处理（键盘中断、空输入等）

### 3. 知识库内容扩展
新增和更新了以下知识库文件：

#### 新增文件：
- `knowledge/standard_parts.md` - 标准零件库信息
  - 包含标准零件库概述和资源（TraceParts、3D ContentCentral等）
  - 轴承规格（深沟球轴承、圆锥滚子轴承）
  - 齿轮规格（正齿轮、齿轮材料）
  - 密封件（O型圈、油封）
  - 弹簧（压缩弹簧、弹簧材料）
  - 联轴器（弹性联轴器、梅花联轴器）
  - 标准键与键槽
  - 如何使用标准零件库

#### 更新文件：
- `knowledge/fasteners.md` - 紧固件信息扩展
  - 详细螺栓规格（六角头螺栓、内六角圆柱头螺栓）
  - 螺栓强度等级（4.6-12.9级）
  - 螺母（六角螺母、锁紧螺母）
  - 垫圈（平垫圈、弹簧垫圈）
  - 销钉（圆柱销、圆锥销）
  - 螺纹规格（公制粗牙、细牙）
  - 紧固件选型指南和拧紧力矩参考

- `knowledge/materials.md` - 材料信息扩展
  - 详细材料分类（碳素结构钢、合金结构钢、不锈钢、工具钢等）
  - 新增用户需求的 **40Cr** 材料信息
  - 铝合金（变形铝、铸造铝）
  - 铜合金（黄铜、青铜）
  - 工程塑料
  - 复合材料
  - 材料选择原则和热处理影响

- `knowledge/tolerances.md` - 公差配合信息扩展
  - 公差基本概念和术语
  - 公差等级表（IT01-IT13）
  - 配合类型（间隙配合、过渡配合、过盈配合）
  - 几何公差（形状公差、位置公差、跳动公差）
  - 表面粗糙度等级
  - 公差设计原则和标注示例

## 技术实现

### 代码修改位置
1. `src/sw_helper/cli.py` - `interactive()` 函数（第1600-1791行）
   - 更新菜单选项为5项
   - 添加第4项"知识库查询"的处理逻辑
   - 实现子菜单循环和异常处理

2. `src/sw_helper/knowledge.py` - 已有完整功能，无需修改
   - 使用现有的 `get_knowledge_base()` 获取单例
   - 调用 `search_and_display()` 进行搜索和显示

### 知识库搜索功能
- 支持大小写不敏感搜索
- 关键词高亮显示（黄色）
- 结果分页显示（Rich Panel格式）
- 未找到结果时提供搜索建议
- 支持中文和英文关键词

## 测试流程

### 1. 启动交互模式
```bash
cae-cli interactive
```

### 2. 查看更新后的菜单
```
CAE-CLI Interactive Mode
┏━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Option ┃ Operation                ┃ Description                       ┃
┡━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│   1    │ Analyze Model            │ Analyze geometry or mesh quality  │
│   2    │ Optimize Parameter       │ Parameter optimization            │
│   3    │ AI Generate Model        │ AI model generation               │
│   4    │ 知识库查询 (Handbook)    │ Query mechanical handbook knowledge base │
│   5    │ Exit                     │ Exit interactive mode             │
└────────┴──────────────────────────┴───────────────────────────────────┘
```

### 3. 选择选项4进入知识库查询
```
Enter your choice (1-5) or command: 4
```

### 4. 输入关键词查询
```
输入关键词: 40Cr
```

### 5. 查看搜索结果
- 显示包含"40Cr"的材料信息
- 高亮显示关键词
- 格式化显示表格和数据

### 6. 返回主菜单
- 输入"back"或直接按Enter返回主菜单
- 选择5退出交互模式

## 命令行直接使用

除了交互模式，还可以直接使用handbook命令：
```bash
# 搜索关键词
cae-cli handbook search "40Cr"

# 搜索材料信息
cae-cli handbook material "Q235"

# 搜索螺栓规格
cae-cli handbook bolt "M10"
```

## 故障排除

### 中文编码问题
如果遇到中文显示问题，可以：
1. 设置终端编码为UTF-8
2. 使用英文关键词搜索
3. 检查系统区域设置

### 知识库文件未加载
确保`knowledge`目录位于项目根目录，包含：
- `fasteners.md`
- `materials.md`
- `standard_parts.md`
- `tolerances.md`

### 搜索无结果
- 检查关键词拼写
- 尝试更通用的关键词
- 查看建议的搜索关键词列表

## 扩展建议

### 未来功能
1. 添加更多机械设计知识（如传动系统、液压气动等）
2. 支持图片和图表显示
3. 添加3D模型预览链接
4. 集成在线零件库API
5. 支持用户自定义知识库

### 性能优化
1. 添加搜索索引加快查询速度
2. 支持分页显示大量结果
3. 添加搜索历史记录
4. 支持模糊搜索和同义词

## 总结

本次更新成功实现了知识库查询功能，并扩展了机械设计相关知识库内容。用户现在可以通过交互菜单或命令行快速查询材料属性、标准零件规格、公差配合等机械设计相关知识，提高了CAE-CLI工具的实用性和学习价值。